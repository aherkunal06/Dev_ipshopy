  <link rel="stylesheet" href="catalog\view\theme\so-mobile\stylesheet\home_content.css">
{{recent_view}}
{# Section 1 Heading and Cards #}
{% if category_name1 %}
<h1 class="section-heading">{{ category_name1 }}</h1>
{% endif %}

<!-- ✅ Subcategory Cards Container -->
<div class="so-subcategory-cards">
    {% for subcat in subcategories1 %}
        <div class="so-card">
            <!-- cart icon -->
            <div class="so-lock-icon">
                <i class="fa fa-shopping-bag"></i>
            </div>

            <!-- image -->
            <div class="so-card-image">
                <img src="{{ subcat.thumb }}" alt="{{ subcat.name }}">
            </div>

            <!-- details -->
            <div class="so-card-body">
                <h1>{{ subcat.name }}</h1>
                <p class="so-series">{{ subcat.series }}</p>
                <p class="so-price">₹{{ subcat.price }}</p>
                <div class="so-rating">
                    {% for i in 1..5 %}
                        {% if i <= subcat.rating %}
                            <span class="so-star filled">★</span>
                        {% else %}
                            <span class="so-star">★</span>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>



{# Section 2 Heading and Cards #}
{% if category_name1 %}
<h2 class="catalogue-heading">{{ category_name1 }}</h2>
{% endif %}

<div class="catalogue-cards">
    {% for subcat in subcategories1 %}
        <div class="catalogue-card">
            <a href="{{ subcat.href }}">
                <div class="catalogue-card-image">
                    <img src="{{ subcat.thumb }}" alt="{{ subcat.name }}">
                </div>
                <div class="catalogue-card-body">
                    <h3>{{ subcat.name }}</h3>
                    <p class="catalogue-price">₹{{ subcat.price }}</p>
                </div>
            </a>
        </div>
    {% endfor %}
</div>



{# Section 3 Heading and Cards #}
{% if category_name2 %}
<div class="furni-heading">{{ category_name2 }}</h2>
{% endif %}

<div class="furni-cards">
    {% for subcat in subcategories2 %}
        <div class="furni-card">
            <a href="{{ subcat.href }}">
                <div class="furni-card-image">
                    <img src="{{ subcat.thumb }}" alt="{{ subcat.name }}">
                </div>
                <div class="furni-card-body">
                    <span class="furni-name">{{ subcat.name }}</span>
                    <p class="furni-price">₹{{ subcat.price }}</p>
                </div>
            </a>
        </div>
    {% endfor %}
</div>

{# Product container (will load via scroll) #}
<div id="product-heading-container"></div>
<div id="infinite-product-container" class="subcategory-cards"></div>

<div id="loader" style="text-align:center; display:none; margin:20px;">
    <img src="catalog/view/theme/so-mobile/image/loader.gif" alt="Loading..." />
</div>


<script>
let start = {{ subcategories1|length }}; // already loaded subcategories
const limit = 4;
const category_id = {{ category_id1 }};
let loading = false;
let type = 'subcategory';

window.addEventListener('scroll', () => {
    if (!loading && (window.innerHeight + window.scrollY) >= document.documentElement.scrollHeight - 100) {
        loadMore();
    }
});

function loadMore() {
    if (loading) return;
    loading = true;

    const loader = document.getElementById('loader');
    loader.style.display = 'block';

    fetch(`index.php?route=common/home_content/loadAllCategories&category_id=${category_id}&start=${start}&limit=${limit}&type=${type}`)
        .then(res => res.json())
        .then(data => {
            loader.style.display = 'none';
            if (!data.items || data.items.length === 0) {
                if (type === 'subcategory') {
                    type = 'product';
                    start = 0;
                    loadMore(); // immediately load first batch of products
                }
                return;
            }

            const container = type === 'subcategory' 
                ? document.getElementById('infinite-subcategory-container')
                : document.getElementById('infinite-product-container');

            // Add product heading dynamically
            if (type === 'product' && !document.getElementById('product-heading')) {
                const headingContainer = document.getElementById('product-heading-container');
                const prodHeading = document.createElement('h2');
                prodHeading.id = 'product-heading';
                prodHeading.textContent = 'Products';
                headingContainer.appendChild(prodHeading);
            }

            data.items.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.innerHTML = `
                    <a href="${item.href}">
                        <div class="card-image"><img src="${item.thumb}" alt="${item.name}"></div>
                        <div class="card-body">
                            <h3>${item.name}</h3>
                            <p>Price: ₹${item.price}</p>
                            ${item.rating !== undefined ? `<p class="rating">${getStars(item.rating)}</p>` : ''}
                        </div>
                    </a>
                `;
                container.appendChild(card);
            });

            start += data.items.length;
            loading = false;
        })
        .catch(err => {
            console.error('Error loading items:', err);
            loader.style.display = 'none';
            loading = false;
        });
}

function getStars(rating) {
    return Array.from({ length: 5 }, (_, i) =>
        i < rating ? '<span class="star filled">★</span>' : '<span class="star">☆</span>'
    ).join('');
}



</script>

{# <style>

#loader img { width: 40px; height: 40px; }

.subcategory-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
}
.card {
    border: 1px solid #ddd;
    border-radius: 10px;
    overflow: hidden;
    width: calc(50% - 20px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: 0.3s;
    margin-bottom: 20px;
}
.card:hover { box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
.card a { color: inherit; text-decoration: none; }
.card-image img { width: 100%; height: 150px; object-fit: cover; }
.card-body { padding: 10px; text-align: center; }
.card-body h3 { font-size: 16px; margin: 0 0 5px; }
.card-body p { margin: 0 0 5px; }
.rating .star { font-size: 16px; color: #ddd; }
.rating .star.filled { color: #f1c40f; }

@media (max-width: 768px) {
    .card { width: 100%; }
}


.subcategory-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
}
.card {
    border: 1px solid #ddd;
    border-radius: 10px;
    overflow: hidden;
    width: calc(50% - 20px);
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    transition: 0.3s;
    margin-bottom: 20px;
}
.card:hover { box-shadow: 0 6px 12px rgba(0,0,0,0.2); }
.card a { color: inherit; text-decoration: none; }
.card-image img { width: 100%; height: 150px; object-fit: cover; }
.card-body { padding: 10px; text-align: center; }
.card-body h3 { font-size: 16px; margin: 0 0 5px; }
.card-body p { margin: 0 0 5px; }
.rating .star { font-size: 16px; color: #ddd; }
.rating .star.filled { color: #f1c40f; }

@media (max-width: 768px) {
    .card { width: 100%; }
}
</style> #}
