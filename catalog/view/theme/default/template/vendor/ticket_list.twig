{#{{ header }}{{ column_left }}#}

{#<div id="content">#}
{#  <div class="container-fluid">#}
{#    <div class="row mb-3">#}
{#      <div class="col-md-6">#}
{#        <h1>My tickets</h1>#}
{#      </div>#}
{#      <div class="col-md-6 text-right">#}
{#        <a href="index.php?route=vendor/ticket_form" class="btn btn-primary">#}
{#          <i class="fa fa-plus"></i> #}
{#        </a>#}
{#        <a href="index.php?route=vendor/dashboard" class="btn" style="background-color:#0f8db3">#}
{#          <i class="fa fa-reply"></i>#}
{#        </a>#}
{#      </div>#}
{#    </div>#}

{#    <div class="panel panel-default">#}
{#      <div class="panel-heading">#}
{#        <h3 class="panel-title"><i class="fa fa-list"></i> Ticket List</h3>#}
{#      </div>#}
{#      <div class="panel-body">#}
{#        <div class="table-responsive">#}
{#          <table class="table table-bordered table-hover">#}
{#            <thead>#}
{#              <tr class="bg-primary">#}
{#                <th>Ticket ID</th>#}
{#                <th>Subject</th>#}
{#                <th>Message</th>#}
{#                <th>Image</th>#}
{#                <th>Status</th>#}
{#                <th>Date Added</th>#}
{#                <th class="text-center">Action</th>#}
{#              </tr>#}
{#            </thead>#}
{#            <tbody>#}
{#              {% if tickets %}#}
{#                {% for ticket in tickets %}#}
{#                  <tr>#}
{#                    <td>{{ ticket.ticket_id }}</td>#}
{#                    <td>{{ ticket.subject }}</td>#}
{#                    <td>{{ ticket.message }}</td>#}
{#                    <td class="text-center">#}
{#                      {% if ticket.image %}#}
{#                        <a href="{{ ticket.image }}" data-fancybox="gallery">#}
{#                          <img src="{{ ticket.image }}" width="50" alt="Ticket Image" class="img-thumbnail">#}
{#                        </a>#}
{#                      {% else %}#}
{#                        No Image#}
{#                      {% endif %}#}
{#                    </td>#}
{#                    <td>#}
{#                      {% if ticket.status == 'Open' %}#}
{#                        <span class="badge badge-success">{{ ticket.status }}</span>#}
{#                      {% elseif ticket.status == 'pending' %}#}
{#                        <span class="badge badge-warning">{{ ticket.status }}</span>#}
{#                      {% else %}#}
{#                        <span class="badge badge-danger">{{ ticket.status }}</span>#}
{#                      {% endif %}#}
{#                    </td>#}
{#                    <td>{{ ticket.date_added }}</td>#}
{#                    <td class="text-center">#}
{#                      <a href="{{ ticket.view }}" class="btn btn-info btn-sm">#}
{#                        <i class="fa fa-eye"></i>#}
{#                      </a>#}
{#                    </td>#}
{#                  </tr>#}
{#                {% endfor %}#}
{#              {% else %}#}
{#                <tr>#}
{#                  <td colspan="7" class="text-center">No tickets found.</td>#}
{#                </tr>#}
{#              {% endif %}#}
{#            </tbody>#}
{#          </table>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{#  </div>#}
{#</div>#}

{#<style>#}
{#.badge {#}
{#  padding: 5px 10px;#}
{#  border-radius: 3px;#}
{#  font-size: 12px;#}
{#}#}
{#.badge-success {#}
{#  background-color: #5cb85c;#}
{#}#}
{#.badge-warning {#}
{#  background-color: #f0ad4e;#}
{#}#}
{#.badge-danger {#}
{#  background-color: #d9534f;#}
{#}#}
{#.bg-primary {#}
{#  background-color: #23237a !important;#}
{#  color: white;#}
{#}#}
{#.btn-info {#}
{#  background-color: #17a2b8;#}
{#  border-color: #17a2b8;#}
{#}#}
{#.table-hover tbody tr:hover {#}
{#  background-color: #f5f5f5;#}
{#}#}
{#</style>#}

{#<!-- FancyBox CSS -->#}
{#<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">#}

{#<script>#}
{#$(document).ready(function() {#}
{#  // Initialize FancyBox for image previews#}
{#  $('[data-fancybox="gallery"]').fancybox({#}
{#    buttons: ["zoom", "close"]#}
{#  });#}
{#});#}
{#</script>#}

{#{{ footer }}#}


{{ header }}
{{ column_left }}

<style>
/* Global Styling for the Dashboard Container */
.my-tickets-dashboard {
    max-width: 1200px;
    margin: 30px auto;
    padding: 20px;
    font-family: 'Inter', sans-serif;
}

.header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 15px;
}

.header-left h3 {
    color: #953a93; /* Changed from #9c0d85 */
    font-weight: 700;
    margin: 0;
    font-size: 28px;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

.search-filter-group {
    display: flex;
    gap: 10px;
    flex-grow: 1;
    max-width: 600px;
}

.search-input-wrapper {
    position: relative;
    flex-grow: 1;
}

.search-input {
    padding-left: 45px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    height: 42px;
    font-size: 15px;
    width: 100%;
}

.search-icon {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: #888;
}

.create-ticket-btn {
    background-color: #953a93; /* Changed from #9c0d85 */
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    transition: background-color 0.2s ease;
    height: 42px;
    white-space: nowrap;
    font-size: 12px;
}
.create-ticket-btn:hover {
    background-color: #7a2e78; /* Slightly darker for hover */
    color: white;
}

/* Cancel Button Updated */
.cancel-icon-button {
    background: #f8f9fa;
    border: 1px solid #ccc;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: red;
    text-decoration: none;
    transition: background 0.2s, color 0.2s, border-color 0.2s;
    cursor: pointer;
}

.cancel-icon-button:hover {
    background: red;      /* Solid red background on hover */
    color: #fff;              /* White icon/text */
    border-color:red;    /* Red border */
}

.cancel-icon-button:hover i {
    color: #fff !important;   /* White icon on hover */
    transition: color 0.2s;
}

.stats-boxes {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: #fff;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.stat-card .icon-circle {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    color: #fff;
}

.stat-card.total-tickets .icon-circle { background-color: #e1bee7; color: #953a93; }
.stat-card.open-tickets .icon-circle { background-color: #ffe0b2; color: #ff9800; }
.stat-card.in-progress .icon-circle { background-color: #bbdefb; color: #2196f3; }
.stat-card.closed .icon-circle { background-color: #c8e6c9; color: #4caf50; }

.stat-card h4 {
    margin: 0;
    font-size: 15px;
    color: #666;
    font-weight: 500;
    order: 2;
}

.stat-card span {
    font-size: 32px;
    font-weight: 700;
    color: #333;
    order: 1;
}

.ticket-table-wrapper {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    border-radius: 12px;
    overflow: hidden;
}

.table {
    margin-bottom: 0;
    border-collapse: separate;
    border-spacing: 0;
}

.table thead tr,
.table thead th {
    background: #953a93 !important; /* Changed from #9c0d85 */
    color: #fff !important;
    font-weight: 700;
}

.table tbody td {
    padding: 12px 12px;
    font-size: 14px;
    color: #444;
    border-top: 1px solid #eee;
}

.table tbody tr:last-child td {
    border-bottom: none;
}

.table-hover tbody tr:hover {
    background-color: #f9f9f9;
}

.badge {
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 12px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.badge-open { background: #d4f4dd; color: #2e7d32; }
.badge-in-progress { background: #e0edff; color: #1e3a8a; }
.badge-closed { background: #eee; color: #444; }

.ticket-image {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
}

.view-ticket-link {
    color: #953a93; /* Changed from #9c0d85 */
    text-decoration: none;
    font-weight: 600;
    transition: color 0.2s ease;
}
.view-ticket-link:hover {
    color: #7a2e78; /* Slightly darker for hover */
}

.eye-square {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: fit-content;
    height: fit-content;
    background: #f3e6f7;
    border-radius: 8px;
    transition: background 0.2s;
    color: #953a93; /* Changed from #9c0d85 */
    font-size: 18px;
    box-shadow: 0 2px 6px rgba(149,58,147,0.07); /* Updated shadow color */
    padding: 5px;
}
.view-eye-btn:hover .eye-square {
    background: #953a93; /* Changed from #9c0d85 */
    color: #fff;
}

.back-square-btn {
    background: #953a93; /* Changed from #820096 */
    color: #fff;
    border-radius: 10px;
    width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 2px 8px rgba(149,58,147,0.08); /* Updated shadow color */
    border: 2px solid #e1bee7;
    text-decoration: none;
    transition: background 0.2s, color 0.2s;
}
.back-square-btn:hover {
    background: #7a2e78; /* Slightly darker for hover */
    color: #fff;
}

@media (max-width: 992px) {
    .header-row {
        flex-direction: column;
        align-items: flex-start;
    }

    .header-right {
        width: 100%;
    }

    .search-filter-group {
        flex-direction: column;
        width: 100%;
    }

    .search-input-wrapper {
        width: 100%;
    }

    .create-ticket-btn {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 576px) {
    .stats-boxes {
        grid-template-columns: 1fr;
    }

    .tab-buttons-group {
        flex-direction: column;
        border: none;
    }

    .tab-button {
        border-radius: 8px;
        margin-bottom: 5px;
        border: 1px solid #e0e0e0;
    }

    .tab-button:not(:last-child) {
        border-right: none;
    }
}

.page {
    margin-top: 20px !important;
}
</style>

<div id="content">
    <div class="my-tickets-dashboard">
        <div class="header-row">
            <div class="header-left">
                <h3>My Tickets</h3>
            </div>
            <div class="header-right"> 
                <div class="search-filter-group">
                    <div class="search-input-wrapper">
                        <i class="fa fa-search search-icon"></i>
                        <input type="text" class="form-control search-input" placeholder="Search tickets id...">
                    </div>
                    <a href="index.php?route=vendor/ticket_form" class="create-ticket-btn">
                        <i class="fa fa-plus-circle"></i> Create New Ticket
                    </a>
                    <a href="index.php?route=vendor/dashboard" class="back-square-btn" title="Back">
                        <i class="fa fa-reply"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="stats-boxes">
            <div class="stat-card total-tickets" data-status="all">
                <div class="icon-circle"><i class="fa fa-pencil-square-o"></i></div>
                <span>{{ total_tickets ?? 0 }}</span>
                <h4>Total Tickets</h4>
            </div>
            <div class="stat-card open-tickets" data-status="open">
                <div class="icon-circle"><i class="fa fa-exclamation-circle"></i></div>
                <span>{{ open_tickets ?? 0 }}</span>
                <h4>Open Tickets</h4>
            </div>
            <div class="stat-card in-progress" data-status="pending">
                <div class="icon-circle"><i class="fa fa-hourglass-half"></i></div>
                <span>{{ in_progress_tickets ?? 0 }}</span>
                <h4>Pending</h4>
            </div>
            <div class="stat-card closed" data-status="closed">
                <div class="icon-circle"><i class="fa fa-check-circle"></i></div>
                <span>{{ closed_tickets ?? 0 }}</span>
                <h4>Closed</h4>
            </div>
        </div>

        <div class="ticket-table-wrapper table-responsive">
            <table class="table table-hover mb-0" id="ticket-table">
                <thead>
                    <tr>
                        <th style="width: 1%;"><input type="checkbox"></th>
                        <th>Ticket ID</th>
                        <th>Subject</th>
                        <th>Message</th>
                        <th>Image</th>
                        <th>Status</th>
                        <th>Date Added</th>
                        <th class="text-center">Action</th>
                    </tr>
                </thead>
                <tbody id="ticket-table-body">
                    {% for ticket in tickets %}
                        <tr data-status="{{ ticket.status|lower }}">
                            <th style="width: 1%;"><input type="checkbox"></th>
                            <td>{{ ticket.ticket_id }}</td>
                            <td>{{ ticket.subject }}</td>
                            <td>{{ ticket.message }}</td>
                            <td>
                                {% if ticket.image %}
                                    <img src="{{ ticket.image }}" alt="Ticket Image" style="width:40px;height:40px;">
                                {% endif %}
                            </td>
                            <td>
                                {% if ticket.status|lower == 'open' %}
                                    <span style="background:#d4f4dd; color:#2e7d32; padding:6px 14px; border-radius:12px; font-weight:600; font-size:13px;">
                                        {{ ticket.status }}
                                    </span>
                                {% elseif ticket.status|lower == 'pending' %}
                                    <span style="background:#fff8e1; color:#ff9800; padding:6px 14px; border-radius:12px; font-weight:600; font-size:13px;">
                                        {{ ticket.status }}
                                    </span>
                                {% elseif ticket.status|lower == 'closed' %}
                                    <span style="background:#ffebee; color:#d32f2f; padding:6px 14px; border-radius:12px; font-weight:600; font-size:13px;">
                                        {{ ticket.status }}
                                    </span>
                                {% else %}
                                    {{ ticket.status }}
                                {% endif %}
                            </td>
                            <td>{{ ticket.date_added }}</td>
                            <td>
                                <a href="{{ ticket.view }}" class="view-ticket-link view-eye-btn" title="View Ticket">
                                    <span class="eye-square"><i class="fa fa-eye"></i></span>
                                    {#<span style="margin-left:6px; font-weight:500; color:#953a93;">View</span>#}
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="8" class="text-center">No tickets found.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-end mt-3 page">
            <nav>
                <ul class="pagination mb-0">
                    <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.stat-card').forEach(function(card) {
        card.addEventListener('click', function() {
            var status = this.getAttribute('data-status');
            filterTicketsByStatus(status);
            document.querySelectorAll('.stat-card').forEach(function(c) {
                c.classList.remove('active');
            });
            this.classList.add('active');
        });
    });

    function filterTicketsByStatus(status) {
        document.querySelectorAll('#ticket-table-body tr').forEach(function(row) {
            var rowStatus = row.getAttribute('data-status');
            row.style.display = (status === 'all' || rowStatus === status) ? '' : 'none';
        });
    }

    const searchInput = document.querySelector('.search-input');
    searchInput.addEventListener('input', function() {
        const searchValue = this.value.trim().toLowerCase();
        document.querySelectorAll('#ticket-table-body tr').forEach(function(row) {
            const ticketIdCell = row.querySelectorAll('td')[0];
            if (!ticketIdCell) return;
            const ticketId = ticketIdCell.textContent.trim().toLowerCase();
            row.style.display = (searchValue === '' || ticketId.includes(searchValue)) ? '' : 'none';
        });
    });
});
</script>

{{ footer }}
