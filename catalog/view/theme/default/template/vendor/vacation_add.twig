{{ header }}
{{ column_left }}

<style>
.center-box-stack {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  margin-bottom: 40px;
}

.box-wrapper {
  background: #fff;
  border: 1px solid #e1e1e1;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.03);
  padding: 25px;
  max-width: 600px;
  width: 100%;
  animation: fadeInSlide 0.5s ease;
}

.alert-custom {
  padding: 10px 15px;
  margin: 15px auto;
  border-radius: 6px;
  font-size: 14px;
  max-width: 400px;
  display: block;
  animation: fadeInSlide 0.5s ease;
}

.alert-danger-custom {
  background-color: #f8d7da;
  border: 1px solid #f5c2c7;
  color: #842029;
}

.alert-success-custom {
  background-color: #d1e7dd;
  border: 1px solid #badbcc;
  color: #0f5132;
}

.alert-custom .close {
  background: none;
  border: none;
  font-size: 16px;
  float: right;
  line-height: 1;
  cursor: pointer;
}

.btn-custom-back {
  background-color: #fff;
  color: #000;
  border: 1px solid #fff;
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 14px;
  transition: all 0.3s ease;
}

.btn-custom-back:hover {
  background-color: #fff;
  color: #000;
  text-decoration: none;
}
</style>

<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right">
        <a href="index.php?route=vendor/vacation_list&user_token={{ user_token }}" class="btn btn-custom-back">
          <i class="fa fa-reply"></i>
        </a>
      </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="container-fluid">

    {% if error_warning %}
    <div class="alert-custom alert-danger-custom">
      <button type="button" class="close" onclick="this.parentElement.style.display='none';">&times;</button>
      <i class="fa fa-exclamation-circle"></i> {{ error_warning }}
    </div>
    {% endif %}

    {% if success and form_submitted %}
      <div class="alert-custom alert-success-custom">
        <button type="button" class="close" onclick="this.parentElement.style.display='none';">&times;</button>
        <i class="fa fa-check-circle"></i> {{ success }}
      </div>
    {% endif %}


    <div class="center-box-stack">
      <!-- Terms & Conditions - first box -->
      <div class="box-wrapper terms-box">
        <div class="terms-wrapper">
          <h3>{{ text_terms_heading }}</h3>
          <ul>
            <li>{{ text_term_clear_orders }}</li>
            <li>{{ text_term_advance_notice }}</li>
            <li>{{ text_term_max_duration }}</li>
          </ul>
        </div>
      </div>

      <!-- Vacation Form - second box -->
      <div class="box-wrapper">
        <div class="vacation-form-wrapper">
          <form action="{{ action }}" method="post" class="form-horizontal" id="vacation-form">
            <div class="form-group">
              <label class="col-sm-4 control-label">{{ text_vendor_name }}</label>
              <div class="col-sm-8">
                <input type="text" name="vendor_name" value="{{ vendor_name }}" class="form-control" readonly />
              </div>
            </div>

            <div class="form-group">
              <label class="col-sm-4 control-label">{{ text_display_name }}</label>
              <div class="col-sm-8">
                <input type="text" name="display_name" value="{{ display_name }}" class="form-control" readonly />
              </div>
            </div>

            <div class="form-group">
              <label class="col-sm-4 control-label">{{ text_processing_order_count }}</label>
              <div class="col-sm-8">
                <input type="text" name="processing_order_count" value="{{ processing_order_count }}" class="form-control" readonly />
              </div>
            </div>

            <div class="form-group">
              <label class="col-sm-4 control-label">{{ entry_start_date }}</label>
              <div class="col-sm-8">
                <input type="date" name="start_date" class="form-control" id="start-date">
                <div id="start-date-error" style="display:none; font-size: 14px; margin-top: 5px;"></div>
              </div>
            </div>

            <div class="form-group">
              <label class="col-sm-4 control-label">{{ entry_end_date }}</label>
              <div class="col-sm-8">
                <input type="date" name="end_date" class="form-control">
              </div>
            </div>

            <div class="form-group">
              <label class="col-sm-4 control-label">{{ entry_reason }}</label>
              <div class="col-sm-8">
                <textarea name="reason" class="form-control" rows="3"></textarea>
              </div>
            </div>

            <div class="form-group">
              <div class="col-sm-offset-4 col-sm-8">
                <div class="checkbox">
                  <label>
                    <input type="checkbox" name="confirm_clear_orders"> {{ text_confirm_orders_cleared }}
                  </label>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="col-sm-offset-4 col-sm-8">
                <button type="submit" class="btn btn-primary">{{ button_apply }}</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById('vacation-form');
  const startDate = document.querySelector('input[name="start_date"]');
  const endDate = document.querySelector('input[name="end_date"]');
  const reason = document.querySelector('textarea[name="reason"]');
  const checkbox = document.querySelector('input[name="confirm_clear_orders"]');

  const startError = createErrorBox(startDate);
  const endError = createErrorBox(endDate);
  const reasonError = createErrorBox(reason);
  const checkboxError = createErrorBox(checkbox.closest('label'));

  function createErrorBox(afterEl) {
    const box = document.createElement('div');
    box.className = 'text-danger';
    box.style.fontSize = '13px';
    box.style.marginTop = '4px';
    box.style.display = 'none';
    afterEl.parentNode.appendChild(box);
    return box;
  }

  function showError(input, errorBox, message) {
    input.classList.add('input-error');
    errorBox.textContent = message;
    errorBox.style.display = 'block';
  }

  function clearError(input, errorBox) {
    input.classList.remove('input-error');
    errorBox.textContent = '';
    errorBox.style.display = 'none';
  }

  function getDateOnly(dateString) {
    // Force date-only comparison (avoid timezone issues)
    const parts = dateString.split('-');
    return new Date(parts[0], parts[1] - 1, parts[2]);
  }

  function validateStart() {
    const val = startDate.value;
    if (!val) {
      showError(startDate, startError, 'Start date is required.');
      return false;
    }

    const selected = getDateOnly(val); // normalized date (00:00)
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const minDate = new Date(today);
    minDate.setDate(minDate.getDate() + 2); // today + 2

    if (selected < minDate) {
      showError(startDate, startError, 'Start date must be at least 2 days from today.');
      return false;
    }

    clearError(startDate, startError);
    return true;
  }

  function validateEnd() {
    const val = endDate.value;
    if (!val) {
      showError(endDate, endError, 'End date is required.');
      return false;
    }

    const start = getDateOnly(startDate.value);
    const end = getDateOnly(endDate.value);

    if (end <= start) {
      showError(endDate, endError, 'End date must be after start date.');
      return false;
    }

    if ((end - start) / (1000 * 60 * 60 * 24) > 30) {
      showError(endDate, endError, 'Vacation cannot exceed 30 days.');
      return false;
    }

    clearError(endDate, endError);
    return true;
  }

  function validateReason() {
    if (!reason.value.trim()) {
      showError(reason, reasonError, 'Vacation reason is required.');
      return false;
    }
    clearError(reason, reasonError);
    return true;
  }

  function validateCheckbox() {
    if (!checkbox.checked) {
      showError(checkbox, checkboxError, 'You must confirm all orders are cleared.');
      return false;
    }
    clearError(checkbox, checkboxError);
    return true;
  }

  form.addEventListener('submit', function (e) {
    const s = validateStart();
    const e1 = validateEnd();
    const r = validateReason();
    const c = validateCheckbox();

    if (!(s && e1 && r && c)) {
      e.preventDefault();
      scrollToFirstError();
    }
  });

  startDate.addEventListener('change', function () {
    validateStart();

    if (startDate.value) {
      const max = getDateOnly(startDate.value);
      max.setDate(max.getDate() + 30);
      endDate.setAttribute('max', max.toISOString().split('T')[0]);
    }
  });

  endDate.addEventListener('change', validateEnd);
  reason.addEventListener('input', validateReason);
  checkbox.addEventListener('change', validateCheckbox);

  function scrollToFirstError() {
    const first = document.querySelector('.text-danger[style*="block"]');
    if (first) {
      const offset = first.getBoundingClientRect().top + window.scrollY - 100;
      window.scrollTo({ top: offset, behavior: 'smooth' });
    }
  }

  // âœ… Set HTML min="yyyy-mm-dd" for input[type=date]
  const today = new Date();
  today.setDate(today.getDate() + 2); // today + 2
  const minDateStr = today.toISOString().split('T')[0];
  startDate.setAttribute('min', minDateStr);
});
</script>

{{ footer }}