{{ header }}{{ column_left }}
<style>

.password-container {
	width: 60% !important;
	margin-top: 20px !important;
}

.panel-body {
    overflow: hidden !important;
}

.pull-center {
    text-align: center !important;
    margin-bottom: 30px !important;
}

.form-horizontal .control-label {
    padding-right: 0;
}

</style>
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-center">
      <div class="pull-right">
		<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-info">
		    <i class="fa fa-reply"></i>
	    </a>
      </div>
      <h1>{{ heading_title }}</h1>
    </div>
  </div>
  <div class="container-fluid password-container">
    {% if error_warning %}
    <div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_form }}</h3>
      </div>
      <div class="panel-body">
        <form action="{{ action }}" method="post" enctype="multipart/form-data" class="form-horizontal">
			<div class="form-group required">
				<label class="col-sm-2 control-label" for="input-oldpassword">{{ entry_oldpassword }}</label>
				<div class="col-sm-10">
				    <div class="input-group">
    					<input type="password" name="oldpassword" value="{{ oldpassword }}" placeholder="{{ entry_oldpassword }}" id="input-oldpassword" class="form-control" />
    				    <span class="input-group-addon" onclick="togglePasswordVisibility('input-oldpassword')">
                          <i id="toggle-oldpassword-icon" class="fa fa-eye" style="cursor: pointer;"></i>
                        </span>
                    </div>
				</div>
			</div>
			<div class="form-group required">
				<label class="col-sm-2 control-label" for="input-password">{{ entry_password }}</label>
				<div class="col-sm-10">
				    <div class="input-group">
    					<input type="password" name="password" value="{{ password }}" placeholder="{{ entry_password }}" id="input-password" class="form-control" />
    					<span class="input-group-addon" onclick="togglePasswordVisibility('input-password')">
                          <i id="toggle-password-icon" class="fa fa-eye" style="cursor: pointer;"></i>
                        </span>
                    </div>
        			<div id="password-requirements" class="text-info" style="font-size: 12px; margin-top: 10px; line-height: 1.2; display: none; color: gray;">
        				Password requirements:
        				<ul style="margin: 0; padding-left: 15px; line-height: 1.3; list-style-type: disc;">
        					<li id="length-check" style="margin: 2px 0;"> Must be at least 8 characters long</li>
        					<li id="uppercase-check" style="margin: 2px 0;"> Must include at least one uppercase letter (A-Z)</li>
        					<li id="number-check" style="margin: 2px 0;"> Must include at least one number (0-9)</li>
        					<li id="symbol-check" style="margin: 2px 0;"> Must include at least one symbol (!@#$%^&*)</li>
        				</ul>
        			</div>
					{% if error_password %}
						<div class="text-danger">{{ error_password }}</div>
					{% endif %}
				</div>
			</div>
			<div class="form-group required">
				<label class="col-sm-2 control-label" for="input-confirm">{{ entry_confirm }}</label>
				<div class="col-sm-10">
				    <div class="input-group">
					    <input type="password" name="confirm" value="{{ confirm }}" placeholder="{{ entry_confirm }}" id="input-confirm" class="form-control" oninput="validateLoginForm()"/>
					    <span class="input-group-addon" onclick="togglePasswordVisibility('input-confirm')">
                          <i id="toggle-confirm-icon" class="fa fa-eye" style="cursor: pointer;"></i>
                        </span>
					</div>
					{% if error_confirm %}
						<div class="text-danger">{{ error_confirm }}</div>
					{% endif %}
				</div>
			</div>
			<div class="buttons">
				<div class="pull-right">
					<input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
				</div>
			</div>

		</form>
      </div>
    </div>
  </div>
  
<script>
function updateIndicator(elementId, isValid) {
  const element = document.getElementById(elementId);
  if (element) {
    element.style.color = isValid ? '#28a745' : '#dc3545';
    const prefix = isValid ? '▼ ' : '► ';
    element.innerHTML = prefix + element.innerHTML.substring(1);
  }
}

function validatePassword() {
  const password = document.getElementById('input-password').value;

  const hasLength = password.length >= 8;
  const hasUppercase = /[A-Z]/.test(password);
  const hasLowercase = /[a-z]/.test(password);
  const hasNumber = /[0-9]/.test(password);
  const hasSymbol = /[!@#$%^&*]/.test(password);

  updateIndicator('length-check', hasLength);
  updateIndicator('uppercase-check', hasUppercase);
  updateIndicator('number-check', hasNumber);
  updateIndicator('symbol-check', hasSymbol);

  return hasLength && hasUppercase && hasLowercase && hasNumber && hasSymbol;
}

function validateLoginForm() {
  const password = document.getElementById('input-password').value;
  const confirmPassword = document.getElementById('confirm-password');
  const isPasswordValid = validatePassword();

  if (confirmPassword && confirmPassword.value !== '') {
    if (password !== confirmPassword.value) {
      alert('Passwords do not match');
      return false;
    }
  }

  const requirementsBox = document.getElementById('password-requirements');
  if (requirementsBox && !isPasswordValid) {
    requirementsBox.style.display = 'block';
  } else {
    requirementsBox.style.display = 'none';
  }

  return isPasswordValid;
}

function togglePasswordVisibility(inputId) {
  const input = document.getElementById(inputId);
  const iconId = (inputId === 'input-password') ? 'toggle-password-icon' : 'toggle-confirm-icon';
  const icon = document.getElementById(iconId);

  if (input && icon) {
    const isHidden = input.type === 'password';
    input.type = isHidden ? 'text' : 'password';
    icon.classList.toggle('fa-eye');
    icon.classList.toggle('fa-eye-slash');
  }
}

document.addEventListener('DOMContentLoaded', function () {
  const passwordInput = document.getElementById('input-password');
  const confirmInput = document.getElementById('confirm-password');

  if (passwordInput) passwordInput.addEventListener('input', validateLoginForm);
  if (confirmInput) confirmInput.addEventListener('input', validateLoginForm);

  if (passwordInput) {
    passwordInput.addEventListener('focus', function () {
      const isValid = validatePassword();
      if (!isValid) {
        document.getElementById('password-requirements').style.display = 'block';
      }
    });
  }
});

function disallowSpaces(inputId) {
  const input = document.getElementById(inputId);
  if (!input) return;
  
  // Prevent space key press
  input.addEventListener('keydown', function (e) {
    if (e.key === ' ') {
      e.preventDefault();
    }
  });

  // Remove spaces if pasted or typed
  input.addEventListener('input', function () {
    input.value = input.value.replace(/\s/g, '');
  });
}

document.addEventListener('DOMContentLoaded', function () {
  disallowSpaces('input-oldpassword');
  disallowSpaces('input-password');
  disallowSpaces('confirm-password');
});
</script>
	
{{ footer }}
