<link rel="stylesheet" href="catalog\view\theme\default\stylesheet\customer\account\account.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">




{{ header }}

<div id="account-account" class="">

	{% if success %}
		<div class="alert alert-success alert-dismissible">
			<i class="fa fa-check-circle"></i>
			{{ success }}</div>
	{% endif %}
<div class='account_wrapper'>
	<div class="" id="account-info-container">
	<!-- Include Font Awesome in your <head> if it's not already loaded -->
<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> -->

  <!-- This simulates your parent container -->



	    {{ column_left_account }}
		<div id="content" class="{{ class }} right_section">

			{# <ul class="breadcrumb">
		{% for breadcrumb in breadcrumbs %}
			<li>
				<a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a>
			</li>
		{% endfor %}
	</ul>
	  <div class="position-relative mb-4">
    <button id="edit-toggle" class="btn btn-primary position-absolute top-0 end-0 mt-2 me-3 d-flex align-items-center" data-state="view">Edit Information
    </button>
  </div> #}
  <table style="width: 100%; border-collapse: collapse; margin-bottom: 1rem;">
  <tr>
    <td style="text-align: left; border: none;">
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
          <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </td>
	

</td>

  </tr>
</table>
	  <!-- Edit Toggle -->


			{{ content_top }}
<table style="width: 100%; margin-bottom: 20px;">
  <tr>
    <!-- Left Cell: Heading -->
    <td style="text-align: left; vertical-align: middle; padding-left: 45px;" >
      {# <h1 class="mb-0"><b>Account Information</b></h1> #}
      <h1 class="mb-0" style="color: #000;"><b>Account Information</b></h1>

    </td>

    <!-- Right Cell: Button with 80px from right edge -->
<td style="text-align: right; vertical-align: middle; padding-right: 80px;">
  <button 
    style="background-color:#953A93; border: none; color: white; border-radius: 6px;" 
    onclick="toggleEditMode()">
    
    <div id="edit-toggle" 
         class="edit-button d-inline-flex align-items-center justify-content-center px-3 py-2 rounded text-white" 
         data-state="view"
         style="background-color: #953A93; cursor: pointer; font-weight: 500; border-radius: 6px; color: white;">
         
      <i class="fa-solid fa-pen edit-icon me-2"></i>
      <span class="edit-text">Edit Information</span>
    </div>
  </button>
</td>

  </tr>
</table>

			<form action="{{ action }}" method="post" enctype="multipart/form-data">



<div class="Account-information container py-4 position-relative">


  <!-- Profile and Info Layout -->
<div class="mb-4">
  <table style="width: auto;">
    <tr style="vertical-align: middle;">
      <!-- Profile Photo Cell -->
      <td style="padding-right: 20px;">
        <div class="profile-photo-wrapper position-relative">
          <div style="width: 100px; height: 100px; border-radius: 50%; background: gray; display: flex; justify-content: center; align-items: center;">
            {% if profile_photo_url %}
            <img src="{{ profile_photo_url }}" id="profile-image" style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%;" class="rounded-circle">
            {% else %}
            <i class="fa-solid fa-user" style='font-size:50px; color:white;'></i>
            {% endif %}
          </div>
          <label class="input-profile-photo position-absolute bottom-0 end-0" style="cursor:pointer;">
            <i class="fa-solid fa-pen" style="color: #953A93;"></i>
          </label>
          <input type="file" name="profile_photo" id="input-profile-photo" accept="image/*" style="display: none;">
        </div>
      </td>

      <!-- Profile Info Cell -->
      <td>
        <h5 class="mb-1" style="font-weight: 600; color: black; font-size:18px;">{{ firstname }} {{ lastname }}</h5>
        <p class="text-muted mb-0">{{ email }}</p>
      </td>
    </tr>
  </table>
</div>



  <!-- Account Information Box -->
  <div class="account-section p-4 bg-white rounded shadow-sm">
    
    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="input-firstname">First Name</label>
        <input type="text" name="firstname" value="{{ firstname }}" placeholder="{{ entry_firstname }}" id="input-firstname" class="form-control editable-field" readonly />
        {% if error_firstname %}<div class="text-danger">{{ error_firstname }}</div>{% endif %}
      </div>
      <div class="col-md-6 mb-3">
        <label for="input-lastname">Last Name</label>
        <input type="text" name="lastname" value="{{ lastname }}" placeholder="{{ entry_lastname }}" id="input-lastname" class="form-control editable-field" readonly />
        {% if error_lastname %}<div class="text-danger">{{ error_lastname }}</div>{% endif %}
      </div>
      <div class="col-md-6 mb-3">
        <label for="input-email">Email Address</label>
        <input type="email" name="email" value="{{ email }}" placeholder="{{ entry_email }}" id="input-email" class="form-control editable-field" readonly />
        {% if error_email %}<div class="text-danger">{{ error_email }}</div>{% endif %}
      </div>
      <div class="col-md-6 mb-3">
        <label for="input-telephone">Mobile No</label>
        <input type="tel" name="telephone" value="{{ telephone }}" placeholder="Mobile No" id="input-telephone" class="form-control editable-field" readonly />
        {% if error_telephone %}<div class="text-danger">{{ error_telephone }}</div>{% endif %}
      </div>
    </div>

    <p class="text-muted small mt-2">Last updated: {{ date_modified }}</p>

    <!-- Buttons -->
    <div class="d-flex justify-content-end gap-2 mt-3">
      {# <button class="btn btn-primary" type="submit" id="continue-button" style="display: none;" disabled>Save Changes</button> #}
      <button class="btn btn-primary" type="submit" id="continue-button" style="display: none; background-color: #953A93; color: white; border: none; border-radius: 6px;" 
  disabled>
  Save Changes
</button>
<button 
  type="button" 
  id="cancel-button" 
  style="
    display: none;
    background-color: #ffffff; 
    color: #953A93; 
    border: 2px solid #953A93; 
    border-radius: 6px;
    padding: 6px 16px;
    font-weight: 500;
    cursor: pointer;
  ">
  Cancel
</button>


    </div>
  </div>
</div>


			</form>

		</div>



		{% for custom_field in custom_fields %}
			{% if custom_field.type == 'select' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{
        custom_field.name }}</label>
					<div class="col-sm-10">
						<select name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control">
							<option value="">{{ text_select }}</option>
							{% for custom_field_value in custom_field.custom_field_value %}
								{% if account_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id
          == account_custom_field[custom_field.custom_field_id] %}
									<option value="{{ custom_field_value.custom_field_value_id }}" selected="selected">{{
            custom_field_value.name }}</option>
								{% else %}
									<option value="{{ custom_field_value.custom_field_value_id }}">{{ custom_field_value.name }}</option>
								{% endif %}
							{% endfor %}
						</select>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'radio' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
					<div class="col-sm-10">
						<div>
							{% for custom_field_value in custom_field.custom_field_value %}
								<div class="radio">
									{% if account_custom_field[custom_field.custom_field_id] and
            custom_field_value.custom_field_value_id == account_custom_field[custom_field.custom_field_id] %}
										<label>
											<input type="radio" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked"/>
											{{ custom_field_value.name }}</label>
									{% else %}
										<label>
											<input type="radio" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}"/>
											{{ custom_field_value.name }}</label>
									{% endif %}
								</div>
							{% endfor %}
						</div>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'checkbox' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
					<div class="col-sm-10">
						<div>
							{% for custom_field_value in custom_field.custom_field_value %}
								<div class="checkbox">
									{% if account_custom_field[custom_field.custom_field_id] and
            custom_field_value.custom_field_value_id in account_custom_field[custom_field.custom_field_id] %}
										<label>
											<input type="checkbox" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked"/>
											{{ custom_field_value.name }}</label>
									{% else %}
										<label>
											<input type="checkbox" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}"/>
											{{ custom_field_value.name }}</label>
									{% endif %}
								</div>
							{% endfor %}
						</div>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'text' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{
        custom_field.name }}</label>
					<div class="col-sm-10">
						<input type="text" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{% if account_custom_field[custom_field.custom_field_id] %}{{ account_custom_field[custom_field.custom_field_id] }}{% else %}{{ custom_field.value }}{% endif %}" placeholder="{{ custom_field.name }}" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control"/>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'textarea' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{
        custom_field.name }}</label>
					<div class="col-sm-10">
						<textarea name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" rows="5" placeholder="{{ custom_field.name }}" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control">
							{% if account_custom_field[custom_field.custom_field_id] %}
								{{ account_custom_field[custom_field.custom_field_id] }}
							{% else %}
								{{ custom_field.value }}
							{% endif %}
						</textarea>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'file' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
					<div class="col-sm-10">
						<button type="button" id="button-custom-field{{ custom_field.custom_field_id }}" data-loading-text="{{ text_loading }}" class="btn btn-default">
							<i class="fa fa-upload"></i>
							{{
          button_upload }}</button>
						<input type="hidden" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{% if account_custom_field[custom_field.custom_field_id] %}{{ account_custom_field[custom_field.custom_field_id] }} {% endif %}"/>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'date' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{
        custom_field.name }}</label>
					<div class="col-sm-10">
						<div class="input-group date">
							<input type="text" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{% if account_custom_field[custom_field.custom_field_id] %}{{ account_custom_field[custom_field.custom_field_id] }}{% else %}{{ custom_field.value }}{% endif %}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control"/>
							<span class="input-group-btn">
								<button type="button" class="btn btn-default">
									<i class="fa fa-calendar"></i>
								</button>
							</span>
						</div>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'time' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{
        custom_field.name }}</label>
					<div class="col-sm-10">
						<div class="input-group time">
							<input type="text" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{% if account_custom_field[custom_field.custom_field_id] %}{{ account_custom_field[custom_field.custom_field_id] }}{% else %}{{ custom_field.value }}{% endif %}" placeholder="{{ custom_field.name }}" data-date-format="HH:mm" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control"/>
							<span class="input-group-btn">
								<button type="button" class="btn btn-default">
									<i class="fa fa-calendar"></i>
								</button>
							</span>
						</div>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
			{% if custom_field.type == 'time' %}
				<div class="form-group{% if custom_field.required %} required {% endif %} custom-field" data-sort="{{ custom_field.sort_order }}">
					<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{
        custom_field.name }}</label>
					<div class="col-sm-10">
						<div class="input-group datetime">
							<input type="text" name="custom_field[{{ custom_field.location }}][{{ custom_field.custom_field_id }}]" value="{% if account_custom_field[custom_field.custom_field_id] %}{{ account_custom_field[custom_field.custom_field_id] }}{% else %}{{ custom_field.value }}{% endif %}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD HH:mm" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control"/>
							<span class="input-group-btn">
								<button type="button" class="btn btn-default">
									<i class="fa fa-calendar"></i>
								</button>
							</span>
						</div>
						{% if error_custom_field[custom_field.custom_field_id] %}
							<div class="text-danger">{{ error_custom_field[custom_field.custom_field_id] }}</div>
						{% endif %}
					</div>
				</div>
			{% endif %}
		{% endfor %}
	</fieldset>

	<!-- <div class="pull-right">
		          <input type="submit" value="{{ button_continue }}" class="btn btn-primary" />
		        </div> -->
</div></form>{{ content_bottom }}</div></div></div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const editToggle = document.getElementById('edit-toggle');
  const imageEditLabel = document.querySelector('.input-profile-photo');
  const imageInput = document.getElementById('input-profile-photo');
  const profileImage = document.getElementById('profile-image');
  const continueBtn = document.getElementById('continue-button');
  const cancelBtn = document.getElementById('cancel-button');
  const editableFields = document.querySelectorAll('.editable-field');

  const firstNameInput = document.getElementById('input-firstname');
  const lastNameInput = document.getElementById('input-lastname');
  const emailInput = document.getElementById('input-email');
  const phoneInput = document.getElementById('input-telephone');

  const originalValues = {};

  // Save original values
  editableFields.forEach(field => {
    originalValues[field.id] = field.value;
    field.setAttribute('readonly', true);
    field.classList.remove('editing');
  });

  // ========== Validation ==========
  function validateField(input, isValid, message) {
    if (!isValid) {
      input.classList.add('is-invalid');
      let error = input.nextElementSibling;
      if (!error || !error.classList.contains('text-danger')) {
        error = document.createElement('div');
        error.className = 'text-danger';
        input.parentNode.appendChild(error);
      }
      error.textContent = message;
    } else {
      input.classList.remove('is-invalid');
      let error = input.nextElementSibling;
      if (error && error.classList.contains('text-danger')) {
        error.remove();
      }
    }
  }

  function validateForm() {
    if (firstNameInput.hasAttribute('readonly')) return; // prevent validation unless editing

    const firstName = firstNameInput.value.trim();
    const lastName = lastNameInput.value.trim();
    const email = emailInput.value.trim();
    const phone = phoneInput.value.trim();

    let valid = true;

    if (firstName.length < 3) {
      validateField(firstNameInput, false, 'First name must be at least 3 characters');
      valid = false;
    } else {
      validateField(firstNameInput, true);
    }

    if (lastName.length < 3) {
      validateField(lastNameInput, false, 'Last name must be at least 3 characters');
      valid = false;
    } else {
      validateField(lastNameInput, true);
    }

    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(email)) {
      validateField(emailInput, false, 'Enter a valid email address');
      valid = false;
    } else {
      validateField(emailInput, true);
    }

    const phonePattern = /^[6-9][0-9]{9}$/;
    if (!phonePattern.test(phone)) {
      validateField(phoneInput, false, 'Enter a valid 10-digit mobile starting with 6-9');
      valid = false;
    } else {
      validateField(phoneInput, true);
    }

    continueBtn.disabled = !valid;
  }

  // ========== Edit Button Toggle ==========
  editToggle.addEventListener('click', function () {
    const state = editToggle.getAttribute('data-state');

    if (state === 'view') {
      editableFields.forEach(field => {
        field.removeAttribute('readonly');
        field.classList.add('editing');
      });

      editToggle.setAttribute('data-state', 'edit');
      editToggle.querySelector('.edit-text').textContent = 'Cancel';
      editToggle.querySelector('.edit-icon').classList.remove('fa-pen');
      editToggle.querySelector('.edit-icon').classList.add('fa-times');

      continueBtn.style.display = 'inline-block';
      cancelBtn.style.display = 'inline-block';

      validateForm(); // run validation as fields become editable
    } else {
      // Cancel Edit
      editableFields.forEach(field => {
        field.setAttribute('readonly', true);
        field.classList.remove('editing');
        field.value = originalValues[field.id];
        validateField(field, true); // remove any validation errors
      });

      editToggle.setAttribute('data-state', 'view');
      editToggle.querySelector('.edit-text').textContent = 'Edit Information';
      editToggle.querySelector('.edit-icon').classList.remove('fa-times');
      editToggle.querySelector('.edit-icon').classList.add('fa-pen');

      continueBtn.style.display = 'none';
      continueBtn.disabled = true;
      cancelBtn.style.display = 'none';

      // Reset profile image
      const originalImage = "{{ profile_photo_url }}";
      if (originalImage) profileImage.src = originalImage;
      imageInput.value = '';
    }
  });

  // ========== Cancel Button ==========
  cancelBtn.addEventListener('click', () => {
    editToggle.click(); // same as clicking "Cancel"
  });

  // ========== Profile Image Logic ==========
  let imageClickLocked = false;

  imageEditLabel.addEventListener('click', function (e) {
    if (imageClickLocked || editToggle.getAttribute('data-state') !== 'edit') {
      e.preventDefault(); // block when not in edit mode
      return;
    }
    imageClickLocked = true;
    imageInput.value = ''; // Clear old selection
    imageInput.click();
    setTimeout(() => imageClickLocked = false, 500);
  });

  imageInput.addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function (e) {
        profileImage.src = e.target.result;
        continueBtn.style.display = 'inline-block';
        continueBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    } else if (file) {
      alert("Please select a valid image file.");
    }
  });

  // ========== Bind input events for validation ==========
  [firstNameInput, lastNameInput, emailInput, phoneInput].forEach(input => {
    input.addEventListener('input', validateForm);
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const editToggle = document.getElementById('edit-toggle');
  const imageEditLabel = document.querySelector('.input-profile-photo');

  if (editToggle && imageEditLabel) {
    editToggle.addEventListener('click', function () {
      // Delay to ensure data-state is updated by other code
      setTimeout(() => {
        const currentState = editToggle.getAttribute('data-state');
        if (currentState === 'edit') {
          imageEditLabel.style.display = 'flex'; // show pencil
        } else {
          imageEditLabel.style.display = 'none'; // hide pencil
        }
      }, 10);
    });
  }
});
</script>




{{ footer }}