{#{{ header }}#}
{#<div id="account-order" class="container">#}
{#  <ul class="breadcrumb">#}
{#    {% for breadcrumb in breadcrumbs %}#}
{#    <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>#}
{#    {% endfor %}#}
{#  </ul>#}
{#  <div class="row">{{ column_left }}#}
{#    {% if column_left and column_right %}#}
{#    {% set class = 'col-sm-6' %}#}
{#    {% elseif column_left or column_right %}#}
{#    {% set class = 'col-sm-9' %}#}
{#    {% else %}#}
{#    {% set class = 'col-sm-12' %}#}
{#    {% endif %}#}
{#    <div id="content" class="{{ class }}">{{ content_top }}#}
{#      <h1>{{ heading_title }}</h1>#}
{#      {% if orders %}#}
{#      <div class="table-responsive">#}
{#        <table class="table table-bordered table-hover">#}
{#          <thead>#}
{#            <tr>#}
{#              <td class="text-left">{{ column_order_id }}</td>#}
{#              <td class="text-left">{{ column_customer }}</td>#}
{#              <td class="text-left">{{ column_product }}</td>#}
{#              <td class="text-left">{{ column_name }}</td>#}
{#              <td class="text-left">{{ column_total }}</td>#}
{#              <td class="text-left">{{ column_date_added }}</td>#}
{#              <td class="text-left">{{column_action}}</td>#}
{#              <td class="text-left">{{column_cancel}}</td>#}
{#              <td class="text-left">{{ column_track }}</td>#}
{#            </tr>#}
{#          </thead>#}
{#          <tbody>#}
{#           {% for order in orders %}#}
{#            <tr>#}
{#              <td class="text-left">#{{ order.order_id }}</td>#}
{#              <td class="text-left">{{ order.name }}</td>#}
{#              <td class="text-right">{{ order.products }}</td>#}
              {#<td class="text-left">{{ order.status }}</td>#}
{#              <td class="text-right">{{ order.total }}</td>#}
{#              <td class="text-left">{{ order.date_added }}</td>#}
{#              <td class="text-right"><a href="{{ order.view }}" data-toggle="tooltip" title="{{ button_view }}" class="btn btn-info"><i class="fa fa-eye"></i></a></td>#}
{#              <td class="text-right">#}
				{#{% if order.status == 'Processing' or order.status == 'Pending' %}#}
				{# {{ url.link('account/order/cancel', 'order_id=' ~ order.order_id) }} #}
				{#<a href="https://www.ipshopy.com/index.php?route=account/order/cancel&order_id={{order.order_id}}" class="btn btn-warning" data-toggle="tooltip" title="{{ button_cancel }}">#}
				{#	<i class="fa fa-times"></i>#}
				{#</a>#}
				{#{% endif %}#}
{#			    	{% set cancellable_statuses = ['Processing', 'Pending', 'Label Generated', 'Manifested', 'Shipment Booked', 'Breached'] %}#}
{#						{% if order.status in cancellable_statuses %}#}
{#							<button type="button" id="cancelbutton" class="btn btn-danger cancel-order" data-order-id="{{ order.order_id }}"   data-awbno="{{ order.awbno }}"  onclick="handleCancelButtonClick(event)">#}
{#								<i class="fa fa-times"></i> Cancel Order#}
{#							</button>#}
{#			    	{% endif %}#}
{#		      </td>#}
{#              <td class="text-right">#}
{#                  <p class="track-btn" data-order-id="{{ order.order_id }}" data-toggle='tooltip' data-original-title='Track Order'>#}
{#                    <img src='https://img.icons8.com/?size=100&id=sWKk2QISB1bz&format=png&color=000000' alt='Track' style='cursor:pointer;width:30px;heigth:30px;margin: 0 0 0 6px;'/>#}
{#                </p>#}
{#              </td>#}
{#            </tr>#}
{#            {% endfor %}#}
{#          </tbody>#}
{#        </table>#}
{#      </div>#}
{#      <div class="row">#}
{#        <div class="col-sm-6 text-left">{{ pagination }}</div>#}
{#        <div class="col-sm-6 text-right">{{ results }}</div>#}
{#      </div>#}
{#      {% else %}#}
{#      <p>{{ text_empty }}</p>#}
{#      {% endif %}#}
{#      <div class="buttons clearfix">#}
{#        <div class="pull-right"><a href="{{ continue }}" class="btn btn-primary">{{ button_continue }}</a></div>#}
{#      </div>#}
{#      {{ content_bottom }}</div>#}
{#    {{ column_right }}</div>#}
{#</div>#}



{#for customer order tracking #}


{#// <script>#}
{#// 	document.addEventListener("DOMContentLoaded", function () {#}
{#// document.querySelectorAll(".track-btn").forEach(function (button) {#}
{#// button.addEventListener("click", function () {#}
{#// let orderId = this.getAttribute("data-order-id");#}

{#// fetch('index.php?route=account/order/getAwbNo&order_id=' + orderId).then(response => response.json()).then(data => {#}
{#// if (data.awbno) {#}
{#// window.open('https://track.shipway.com/t/' + data.awbno, '')#}
{#// } else {#}
{#// console.log("AWB No not found for Order ID " + orderId);#}
{#// }#}
{#// }).catch(error => console.error("Error fetching AWB No:", error));#}
{#// });#}
{#// });#}
{#// });#}
{#// </script>#}

{#<script>#}
{#document.addEventListener("DOMContentLoaded", function () {#}
{#  document.querySelectorAll(".track-btn").forEach(function (button) {#}
{#    button.addEventListener("click", function () {#}
{#      let orderId = this.getAttribute("data-order-id");#}

{#      fetch('index.php?route=account/order/getAwbNo&order_id=' + orderId, {#}
{#        headers: { 'Accept': 'application/json' }#}
{#      })#}
{#      .then(response => response.json())#}
{#      .then(data => {#}
{#        if (data.awbno) {#}
{#          window.open('https://track.shipway.com/t/' + data.awbno, '_blank');#}
{#        } else {#}
{#          alert("Tracking details not available yet!");#}
{#          console.log("AWB No not found for Order ID " + orderId);#}
{#        }#}
{#      })#}
{#      .catch(error => {#}
{#        console.error("Error fetching AWB No:", error);#}
{#        alert("Error retrieving tracking details. Please try again later.");#}
{#      });#}
{#    });#}
{#  });#}
{#});#}
{#</script>#}



{#added on 19-02-2025 #}

{#<script>#}
    

{#function handleCancelButtonClick(event) {#}
{#    event.preventDefault();#}

    {#// Get the cancel button that was clicked#}
{#    let cancelButton = event.target;#}

    {#// Fetch order-specific data from the clicked button#}
{#    let orderId = cancelButton.getAttribute("data-order-id");#}
{#    let orderStatus = cancelButton.getAttribute("data-order-status");#}
{#    let awbNo = cancelButton.getAttribute("data-awbno");#}

{#    console.log("awb no", awbNo);#}

{#    if (!awbNo) {#}
{#        processCancellation(orderId, "order");#}
{#    } else if (awbNo) {#}
{#        processCancellation(orderId, "shipment");#}
{#    } else {#}
{#        alert("This order cannot be canceled at this stage.");#}
{#    }#}
{#}#}

{#function processCancellation(orderId, type) {#}
{#    let url = type === "order" ? 'index.php?route=account/order/cancel' : 'index.php?route=account/order/cancelShipwayOrder';#}
{#    let confirmationMsg = type === "order" ? "Are you sure you want to cancel this order?" : "Are you sure you want to cancel this shipment via Shipway?";#}

{#    if (!confirm(confirmationMsg)) {#}
{#        return;#}
{#    }#}

    {#// Disable the button to prevent multiple clicks#}
{#    let cancelButton = document.querySelector(`[data-order-id="${orderId}"]`);#}
{#    if (cancelButton) {#}
{#        cancelButton.disabled = true;#}
{#    }#}

{#    fetch(url, {#}
{#        method: 'POST',#}
{#        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },#}
{#        body: 'order_id=' + orderId#}
{#    })#}
{#    .then(response => response.json())#}
{#    .then(data => {#}
{#        if (data.success) {#}
{#            alert(data.success);#}
{#            location.reload();#}
{#        } else {#}
{#            alert(data.error);#}
{#        }#}
{#    })#}
{#    .catch(error => {#}
{#        alert('Error: ' + error);#}
{#    });#}
{#}#}

{#</script>#}


{#{{ footer }}#}



{{ header }}

<style>
/* ORDER PAGE CSS */
.order-card-container {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.order-card {
  background: #fff;
  padding: 15px 20px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  border: 1px solid #eee;
  font-family: 'Segoe UI', sans-serif;
}

.order-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  font-size: 15px;
  font-weight: 600;
}

.order-status {
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  text-transform: capitalize;
  display: inline-block;
}

.order-status.delivered {
  background-color: #e6f4ea;
  color: #198754;
}

.order-status.shipped {
  background-color: #e5f0fd;
  color: #0d6efd;
}

.order-status.pending {
  background-color: #fff3cd;
  color: #856404;
}

.order-status.cancelled {
  background-color: #f8d7da;
  color: #721c24;
}

.order-body {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap: wrap;
}
.product_info_container{
    display:flex;
    justify-content: space-between;
    width: 100%;
}
.track_cancel{
    display:flex;
    flex-direction:column;
    align-items: end;
}
.product-info {
    width:80%;
  display: flex;
  align-items: center;
  gap: 12px;
}

.product-image {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 10px;
  border: 1px solid #ccc;
}

.product-details {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.product-name {
  font-size: 16px;
  font-weight: 500;
  margin: 0;
  color: #333;
}

.additional-items {
  font-size: 14px;
  color: #888;
}

.order-footer {
  display: flex;
  justify-content: end;
  align-items: center;
  gap: 5px;
  width: 100%;
}

.order-total {
  font-weight: 700;
  font-size: 17px;
  color: #000;
}

.view-details {
  color: #953A93 !important;
  font-weight: 600;
  font-size: 15px;
  text-decoration: none;
  transition: 0.3s;
}

.view-details:hover {
  text-decoration: underline;
}

.order-date {
  font-size: 14px;
  color: #666;
}

#order-heading {
  font-size: 36px;
  margin-bottom: 20px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 10px;
}

.back-arrow {
  display: none;
  cursor: pointer;
  font-size: 24px;
  color: #333;
}

@media (max-width: 1440px), (max-width: 1120px), (max-width: 768px) {
  .order-footer {
    flex-direction: row;
    justify-content: flex-end;
    align-items: center;
    gap: 20px;
    margin-top: 10px;
    width: 100%;
  }

  .order-total {
    font-size: 17px;
    font-weight: 700;
    color: #000;
  }

  .view-details {
    font-size: 15px;
    color: #c11283;
    font-weight: 600;
    text-decoration: none;
  }
}

/* Sidebar CSS */
.custom-sidebar {
  background-color: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;
  font-family: 'Segoe UI', sans-serif;
}

.sidebar-heading {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}

.sidebar-heading img {
  width: 40px;
  height: 40px;
}

.sidebar-heading span {
  font-size: 18px;
  font-weight: bold;
  color: #333;
}

.sidebar-menu {
  list-style: none;
  padding: 0;
  margin: 0;
}

.sidebar-menu li {
  margin-bottom: 12px;
}

.sidebar-menu li a {
  text-decoration: none;
  color: #444;
  font-size: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: 0.3s;
}

.sidebar-menu li a:hover {
  color: #d63384;
  font-weight: 600;
}

.sidebar-menu li.active a {
  color: #d63384;
  font-weight: 700;
}

@media (max-width: 768px) {
  .custom-sidebar {
    display: none;
  }

  .col-sm-3,
  .col-sm-9,
  .col-sm-6,
  .col-sm-12 {
    width: 100%;
  }
}

@media (max-width: 425px) {
  .order-footer {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    margin-top: 10px;
    width: 100%;
  }

  .order-total {
    font-size: 17px;
    font-weight: 700;
    color: #000;
    order: 1;
  }

  .view-details {
    font-size: 15px;
    color: #c11283;
    font-weight: 600;
    text-decoration: none;
    order: 2;
    align-self: flex-end;
  }

  .back-arrow {
    display: inline-block;
  }
}
.cancel-order{
    cursor:pointer;
    color:red;
    font-size:14px;
}
.track-btn,.cancel-order{
    background: transparent;
    padding: 3px 13px;
    border-radius: 4px;
    font-weight:500;
}
.track-btn{
    border:1px solid #953A93;
    color:#953A93;
}
.cancel-order{
    border:1px solid red;
    color: red;
}
</style>

<link rel="stylesheet" href="catalog/view/theme/default/stylesheet/order_list.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div id="account-order" class="container">
  <ul class="breadcrumb">
    {% for breadcrumb in breadcrumbs %}
      <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
    {% endfor %}
  </ul>


<div class='account_wrapper'>
	<div class="" id="account-info-container">
	
	    {{ column_left_account }}
  {#<div class="row">#}
    
    {#<!-- Sidebar Start -->#}
   {#{{column_left_account}}#}
    {#<!-- Sidebar End -->#}

    {% if column_left and column_right %}
      {% set class = 'col-sm-6' %}
    {% elseif column_left or column_right %}
      {% set class = 'col-sm-9' %}
    {% else %}
      {% set class = 'col-sm-9' %}
    {% endif %}

    <div id="content" class="{{ class }}">
      {{ content_top }}

      {% if orders %}
        <h1 id="order-heading" class="order-title">
          <span class="back-arrow" onclick="window.history.back();"><i class="fas fa-arrow-left"></i></span>
          {{ heading_title }}
        </h1>

        <div class="order-card-container">
          {% for order in orders %}
            <div class="order-card">
              <div class="order-header">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <span class="order-id">#{{ order.order_id }}</span>
                  <span class="order-status {{ order.status|lower }}">{{ order.status }}</span>
                </div>
                <span class="order-date">{{ order.date_added }}</span>
              </div>

              <div class="order-body">
                  <div class='product_info_container'>
                      
                <div class="product-info">
                  <img src="{{ order.product_image }}" alt="Product Image" class="product-image" />
                  <div class="product-details">
                    <p class="product-name">{{ order.product_names }}</p>
                  </div>
                 </div>
                 <div><span class="order-total">{{ order.total }}</span></div>
        {#         <div class='track_cancel'>#}
			    	{#track order#}
			    
        {#         </div>#}
                </div>
                <div class="order-footer">
                  
                  <a href="{{ order.view }}" class="view-details">View Details</a>
                    {% set track_statuses = ['Processing', 'Pending', 'Cancelled', 'Reversed', 'Breached'] %}
                    {% if order.status not in track_statuses %}
                      	<button class="track-btn" data-order-id="{{ order.order_id }}" data-toggle='tooltip' data-original-title='Track Order'>
                            {#<img src='https://img.icons8.com/?size=100&id=sWKk2QISB1bz&format=png&color=000000' alt='Track' style='cursor:pointer;width:30px;heigth:30px;margin: 0 0 0 6px;'/>#}
                            Track Order
                        </button>
                    {% endif %}
                    {% set cancellable_statuses = ['Processing', 'Pending', 'Label Generated', 'Manifested', 'Shipment Booked', 'Breached', 'Pickup Pending', 'AWBRegistered'] %}
					{% if order.status in cancellable_statuses %}
						<button type="button" id="cancelbutton" class="cancel-order" data-order-id="{{ order.order_id }}"   data-awbno="{{ order.awbno }}"  onclick="handleCancelButtonClick(event)">
							<i class="fa fa-times"></i> Cancel Order
						</button>
			    	{% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        

        <div class="row">
          <div class="col-sm-6 text-left">{{ pagination }}</div>
          <div class="col-sm-6 text-right">{{ results }}</div>
        </div>
      {% else %}
        <p>{{ text_empty }}</p>
      {% endif %}

      <div class="buttons clearfix">
        <div class="pull-right"><a href="{{ continue }}" class="btn btn-primary">{{ button_continue }}</a></div>
      </div>

      {{ content_bottom }}
    </div>
  </div>
</div>
</div>
 <script>
  const limit = 4;
  const headings = document.querySelectorAll(".productNameShort");

  headings.forEach((h) => {
    const fullText = h.innerText;
    const words = fullText.split(" ");
    if (words.length > limit) {
      h.innerText = words.slice(0, limit).join(" ") + "...";
      h.title = fullText;
    }
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".track-btn").forEach(function (button) {
    button.addEventListener("click", function () {
      let orderId = this.getAttribute("data-order-id");
      console.log(orderId);

      fetch('index.php?route=account/order/getAwbNo&order_id=' + orderId, {
        headers: { 'Accept': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        if (data.awbno) {
        //   window.open('https://track.shipway.com/t/' + data.awbno, '_blank');
           window.open('https://ipshopy.clickpost.in/en?order_id=' + orderId, '_blank');
        } else {
          alert("Tracking details not available yet!");
          console.log("AWB No not found for Order ID " + orderId);
        }
      })
      .catch(error => {
        console.error("Error fetching AWB No:", error);
        alert("Error retrieving tracking details. Please try again later.");
      });
    });
  });
});
</script>


{#<script>#}
{#function handleCancelButtonClick(event) {#}
{#    event.preventDefault();#}

    {#// Get the cancel button that was clicked#}
{#    let cancelButton = event.target;#}

    {#// Fetch order-specific data from the clicked button#}
{#    let orderId = cancelButton.getAttribute("data-order-id");#}
{#    let orderStatus = cancelButton.getAttribute("data-order-status");#}
{#    let awbNo = cancelButton.getAttribute("data-awbno");#}

{#    console.log("awb no", awbNo);#}

{#    if (!awbNo) {#}
{#        processCancellation(orderId, "order");#}
{#    } else if (awbNo) {#}
{#        processCancellation(orderId, "shipment");#}
{#    } else {#}
{#        alert("This order cannot be canceled at this stage.");#}
{#    }#}
{#}#}

{#function processCancellation(orderId, type) {#}
{#    let url = type === "order" ? 'index.php?route=account/order/cancel' : 'index.php?route=account/order/cancelShipwayOrder';#}
{#    let confirmationMsg = type === "order" ? "Are you sure you want to cancel this order?" : "Are you sure you want to cancel this shipment via Shipway?";#}

{#    if (!confirm(confirmationMsg)) {#}
{#        return;#}
{#    }#}

    {#// Disable the button to prevent multiple clicks#}
{#    let cancelButton = document.querySelector(`[data-order-id="${orderId}"]`);#}
{#    if (cancelButton) {#}
{#        cancelButton.disabled = true;#}
{#    }#}

{#    fetch(url, {#}
{#        method: 'POST',#}
{#        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },#}
{#        body: 'order_id=' + orderId#}
{#    })#}
{#    .then(response => response.json())#}
{#    .then(data => {#}
{#        if (data.success) {#}
{#            alert(data.success);#}
{#            location.reload();#}
{#        } else {#}
{#            alert(data.error);#}
{#        }#}
{#    })#}
{#    .catch(error => {#}
{#        alert('Error: ' + error);#}
{#    });#}
{#}#}

{#</script>#}


<script>
function handleCancelButtonClick(event) {
    event.preventDefault();

    // Get the cancel button that was clicked
    let cancelButton = event.target;

    // Fetch order-specific data from the clicked button
    let orderId = cancelButton.getAttribute("data-order-id");
    // let orderStatus = cancelButton.getAttribute("data-order-status");
    let awbNo = cancelButton.getAttribute("data-awbno");

    console.log("awb no", awbNo);

    if (!awbNo) {
        processCancellation(orderId, "order");
    } else if (awbNo) {
        processCancellation(orderId, "shipment");
    } else {
        alert("This order cannot be canceled at this stage.");
    }
}

function processCancellation(orderId, type) {
    let url = type === "order" ? 'index.php?route=account/order/cancel' : 'index.php?route=clickpost/cancel/clickpostcancel';
    let confirmationMsg = type === "order" ? "Are you sure you want to cancel this order?" : "Are you sure you want to cancel this shipment?";

    if (!confirm(confirmationMsg)) {
        return;
    }

    // Disable the button to prevent multiple clicks
    let cancelButton = document.querySelector(`[data-order-id="${orderId}"]`);
    if (cancelButton) {
        cancelButton.disabled = true;
    }

    fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'order_id=' + orderId
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.success);
            location.reload();
        } else {
            alert(data.error);
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}
</script>

{{ footer }}


