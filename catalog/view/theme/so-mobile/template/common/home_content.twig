{{header}}
{{recent_view}}
     <link rel="stylesheet" href="catalog\view\theme\so-mobile\stylesheet\home_content.css">

{# /* 09-09-2025 addded new_____________________________________________________ */ #}

<div class="so-subcategory-wrapper">
  {% for chunk in subcategories1|batch(6) %}
    <div class="so-subcategory-cards">
        {% for subcat in chunk %}
            <div class="so-card-link" onclick="window.location.href='{{ subcat.href }}'">
                <div class="so-card">
                    <div class="so-card-image">
                        <img src="{{ subcat.thumb }}" alt="{{ subcat.name }}">
                    </div>
                    <div class="so-card-body">
                        <div class="first-heading">
                            {{ subcat.name|length > 15 ? subcat.name|slice(0, 13) ~ '..' : subcat.name }}
                        </div>
                        <div class="so-price">From ₹{{ subcat.price }}</div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
  {% endfor %}
</div>


    <div id="home-sections"></div>
    <div id="loading" style="text-align:center; display:none;">Loading...</div>


  <script>
    // --------------------------
 
    // --------------------------
    let page = 1;       
    let loading = false; 
      let endReached = false;;

    // --------------------------
    // LoadMore Function
    // --------------------------
    function loadMore() {
       
       if (loading || endReached) return;  
        loading = true; 

       
        fetch('index.php?route=common/home_content/loadMore&page=' + page)
            .then(res => res.json()) 
            .then(data => {
                console.log('response page=' + page, data);

                
                if (data.sections && data.sections.length > 0) {

                    
                    data.sections.forEach((section, index) => {

                        // --------------------------
                       
                        // --------------------------
                        let sectionHtml = `
                            <div class="home-section" id="section-${page}-${index}">
                                <div class="home-section-heading">${section.title}</div>
                                <div class="subcategory-cards">
                        `;

                        // --------------------------
                        // Custom Designs 
                        // --------------------------





/* 09-09-2025 addded new_____________________________________________________ */



                        // PAGE 1, INDEX 0
                         if (page === 1 && index === 0) {
                            sectionHtml += `<div class="cards-wrapper">`;
                            section.items.forEach(item => {
                                sectionHtml += `
                                    <div class="card-design-0">
                                        <div class="card-link" onclick="window.location.href='${item.href}'">
                                            <img class="index0-img" src="${item.thumb}" alt="${item.name}">
                                            <div class="index0-heading">${item.name}</div>
                                            <div class="index0-price" style="color:#953A93; font-weight:600;">
                                                From <span style="color:#953A93;">
                                                    ${item.special && item.special !== '' ? item.special : item.price}
                                                </span>
                                                ${item.special && item.special !== '' ? `<span class="old-price" style="color:#888; text-decoration:line-through; margin-left:5px;">${item.price}</span>` : ''}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            });
                            sectionHtml += `</div>`;
                        }

/* 09-09-2025 addded new_____________________________________________________ ----------------------------*/

                        // PAGE 1, INDEX 1 (Today's Best Deals)
                       else if (page === 1 && index === 1) {
    sectionHtml += `<div class="deal-wrapper-1"><div class="deal-scroll-container"><div class="deal-grid-1">`;
    section.items.forEach(prod => {
        sectionHtml += `
            <div class="deal-card-1">
                <div class="deal-link-1" onclick="window.location.href='${prod.href}'">
                    <div class="deal-image-1">
                        <img src="${prod.thumb}" alt="${prod.name}">
                    </div>
                    <div class="deal-info-1">
                        <div class="deal-name-1">
                            ${prod.name.length > 15 ? prod.name.slice(0, 15) : prod.name}
                        </div>
                        <div class="deal-rating-1">
                            ${[1,2,3,4,5].map(i => i <= prod.rating ? '<span class="star-1">★</span>' : '<span class="star-1 empty">★</span>').join('')}
                        </div>
                        <div class="deal-price-1">
                            <span class="special-1">${prod.special}</span>
                            ${prod.price && prod.price !== prod.special ? `<span class="old-price-1">${prod.price}</span>` : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    sectionHtml += `</div></div></div>`;
}


                        // PAGE 2, INDEX 0
       else if (page === 2 && index === 0) {
    sectionHtml += `<div class="best-deals-grid">`;
    section.items.forEach(prod => {
        sectionHtml += `
            <div class="best-deals-card">
                <div class="best-deals-link" onclick="window.location.href='${prod.href}'">
                    <div class="best-deals-image">
                        <img src="${prod.thumb}" alt="${prod.name}">
                    </div>
                    <div class="best-deals-info">
                        <div class="best-deals-name">
                            ${prod.name.length > 15 ? prod.name.slice(0, 12) + '...' : prod.name}
                        </div>
                        <div class="best-deals-price" style="color:#953A93; font-weight:600;">
                            From <span class="current-price" style="color:#953A93;">
                                ${prod.special && prod.special !== '' ? prod.special : prod.price}
                            </span>
                            ${prod.special && prod.special !== '' ? `<span class="old-price" style="color:#888; text-decoration:line-through; margin-left:5px;">${prod.price}</span>` : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    sectionHtml += `</div>`;
}




                        // PAGE 2, INDEX 1
                         else if (page === 2 && index === 1) {
                        sectionHtml += `
                            <div class="card-layout">
                                <div class="big-card">
                                    <div class="index3-link" onclick="window.location.href='${section.items[0].href}'">
                                        <img class="index3-img" src="${section.items[0].thumb}" alt="${section.items[0].name}">
                                        <h3 class="index3-heading">
                                             ${section.items[0].name.length > 20 ? section.items[0].name.slice(0, 20) + '...' : section.items[0].name}
                                         </h3>

                                        <div class="big-card-index3-rating">
                                            ${[1,2,3,4,5].map(i => i <= section.items[0].rating ? '<span class="star">★</span>' : '<span class="star empty">★</span>').join('')}
                                        </div>
                                        <div class="big-card-index3-price">
                                            <span class="big-card-current-price">
                                                ${section.items[0].special && section.items[0].special !== '' ? section.items[0].special : section.items[0].price}
                                            </span>
                                            ${section.items[0].special && section.items[0].special !== '' ? `<span class="big-card-old-price">${section.items[0].price}</span>` : ''}
                                        </div>
                                    </div>
                                </div>
                                <div class="small-card-column">
                                    ${section.items.slice(1,3).map(item => `
                                        <div class="small-card" onclick="window.location.href='${item.href}'">
                                            <img class="small-img" src="${item.thumb}" alt="${item.name}">
                                            <h4 class="small-heading">
                                                ${item.name.length > 18 ? item.name.slice(0, 13) + '...' : item.name}
                                                </h4>

                                            <div class="small-card-index3-rating">
                                                ${[1,2,3,4,5].map(i => i <= item.rating ? '<span class="star">★</span>' : '<span class="star empty">★</span>').join('')}
                                            </div>
                                            <div class="small-card-index3-price">
                                                <span class="small-card-current-price">
                                                    ${item.special && item.special !== '' ? item.special : item.price}
                                                </span>
                                                ${item.special && item.special !== '' ? `<span class="small-card-old-price">${item.price}</span>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                        // PAGE 3, INDEX 0
                       else if (page === 3 && index === 0) {
    sectionHtml += `<div class="recent-grid">`;
    section.items.forEach(prod => {
        sectionHtml += `
            <div class="recent-card">
                <div class="recent-link" onclick="window.location.href='${prod.href}'">
                    <div class="recent-image">
                        <img src="${prod.thumb}" alt="${prod.name}">
                    </div>
                    <div class="recent-info">
                        <div class="recent-name">
                            ${prod.name.length > 17 ? prod.name.slice(0, 17) + '...' : prod.name}
                        </div>
                        <div class="recent-price" style="color:#953A93; font-weight:600;">
                            From <span style="color:#953A93;">
                                ${prod.special && prod.special !== '' ? prod.special : prod.price}
                            </span>
                            ${prod.special && prod.special !== '' 
                                ? `<span class="old-price" style="color:#888; text-decoration:line-through; margin-left:5px;">
                                       ${prod.price}
                                   </span>` 
                                : ''}
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    sectionHtml += `</div>`;
}

                         
                        // PAGE 4, INDEX 0
                        // else if (page === 4 && index === 0) {
                        //     sectionHtml += `<div class="deal-grid-4">`;
                        //     section.items.forEach(item => {
                        //         sectionHtml += `
                        //             <div class="deal-card-4">
                        //                 <a href="${item.href}">
                        //                     <div class="deal-image-4"></div>
                        //                     <div class="deal-info-4">
                        //                         <div class="deal-name-4">${item.name}</div>
                        //                     </div>
                        //                 </a>
                        //             </div>
                        //         `;
                        //     });
                        //     sectionHtml += `</div>`;
                        // }

                        // Default Design
                         else {
    sectionHtml += `<div class="cards-default-wrapper">`;
    section.items.forEach(prod => {
        sectionHtml += `
            <div class="custom-default">
                <div class="custom-default-link" onclick="window.location.href='${prod.href}'">
                    <div class="custom-default-image">
                        <img src="${prod.thumb}" alt="${prod.name}">
                    </div>
                    <div class="custom-default-title">
                        ${prod.name.length > 18 ? prod.name.slice(0, 15) + '...' : prod.name}
                    </div>
                    <div class="custom-default-price" style="color:#953A93; font-weight:600;">
                        From <span style="color:#953A93;">
                            ${prod.special && prod.special !== '' ? prod.special : prod.price}
                        </span>
                        ${prod.special && prod.special !== '' 
                            ? `<span class="old-price" style="color:#888; text-decoration:line-through; margin-left:5px;">
                                   ${prod.price}
                               </span>` 
                            : ''}
                    </div>
                </div>
            </div>
        `;
    });
    sectionHtml += `</div>`;
}


                        // --------------------------
                        // section
                        // --------------------------
                        sectionHtml += `
                                </div>
                            </div>
                        `;

                        // --------------------------
                        // Insert Logic
                        // --------------------------
                     if (page === 1 && index === 0) {
    console.log("Insert Logic → page=1, index=0");
    document.getElementById('home-sections')
        .insertAdjacentHTML('beforeend', sectionHtml);
}
else if (page === 1 && index === 1) {
    console.log("Insert Logic → page=1, index=1");
    document.getElementById('home-sections')
        .insertAdjacentHTML('beforeend', sectionHtml);
}
else if (page === 1 && index === 1) {
    console.log("Insert Logic → page=2, index=0");
    document.getElementById('home-sections')
        .insertAdjacentHTML('afterbegin', sectionHtml);
}
else if (page === 2 && index === 0) {
    console.log("Insert Logic → page=3, index=0");
    document.getElementById('home-sections')
        .insertAdjacentHTML('beforeend', sectionHtml);


}
else {
    console.log(`Insert Logic → default (page=${page}, index=${index})`);
    document.getElementById('home-sections')
        .insertAdjacentHTML('beforeend', sectionHtml);
}


                    });

                  
                    page++;
                } else {
                    console.log("No more sections for page=" + page);
                    endReached = true;
                }

                loading = false;

               
                if (document.body.offsetHeight <= window.innerHeight) {
                    loadMore();
                }
            })
            .catch(err => {
                console.error(err);
                loading = false;
            });
    }

    // --------------------------
   
    // --------------------------
    loadMore();

    // --------------------------
    // Infinite Scroll Event
    // --------------------------
    window.addEventListener('scroll', () => {
        console.log("scroll check", window.innerHeight + window.scrollY, document.body.offsetHeight);
        if (!loading && window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
            loadMore();
        }
    });
</script>

