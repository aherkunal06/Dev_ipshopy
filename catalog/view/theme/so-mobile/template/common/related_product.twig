<!-- Related Products Section -->
<style>
/* ===========================
   RELATED PRODUCTS SECTION
=========================== */

/* Hide section until 3+ products are loaded */
.related-products-section {
  display: none;
  margin: 16px 0;
}
.related-products-section.is-visible {
  display: block;
}

/* Section title bar */
.related-products-title {
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  background: #7b1fa2;
  padding: 8px 12px;
  border-radius: 8px;
  margin-bottom: 10px;
  display: inline-block;
}

/* Horizontal product list */
.related-products-grid {
  display: flex;
  gap: 5px;
  overflow-x: auto;
  padding: 8px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}

.related-products-grid::-webkit-scrollbar {
  display: none; /* Chrome/Safari hide scrollbar */
}

/* Individual Product Card */
.related-product-card {
  flex: 0 0 calc(37%); /* ðŸ‘ˆ shows ~2.5 cards per screen */
  scroll-snap-align: start;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  padding: 10px 5px;
  box-sizing: border-box;
  text-align: center;
  border: 1px solid #eee;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.related-product-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

/* Product Image */
.related-product-img {
  display: block;
  width: 100%;
  aspect-ratio: 1 / 1;
  overflow: hidden;
  border-radius: 10px;
  background: #f9f9f9;
}
.related-product-img img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

/* Product Name */
.related-product-name {
  margin: 8px 0 4px;
  font-size: 13px;
  color: #222;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.related-product-name a {
  text-decoration: none;
  color: inherit;
}

/* Price Styling */
.related-product-price {
  font-size: 13px;
  margin-top: 2px;
}
.related-price-old {
  text-decoration: line-through;
  opacity: 0.6;
  margin-right: 4px;
}
.related-price-new {
  font-weight: 600;
  color: #d32f2f;
}

/* Desktop view - show more cards */
@media (min-width: 768px) {
  .related-product-card {
    flex: 0 0 calc(25% - 8px); /* 4 per row */
  }
}
</style>

<!-- Section HTML -->
<div class="related-products-section">
  <h3 class="related-products-title">Related Products</h3>
  <div id="related-products-container" class="related-products-grid"></div>
</div>

<!-- Script -->
<script>
(function(){
  const section   = document.querySelector('.related-products-section');
  const container = document.getElementById('related-products-container');
  if (!section || !container) return;

  section.classList.remove('is-visible');
  container.innerHTML = '';

  fetch('index.php?route=common/related_product/loadRelated')
    .then(res => res.json())
    .then(data => {
      const items = (data && Array.isArray(data.related)) ? data.related : [];
      if (items.length < 3) {
        section.classList.remove('is-visible');
        return;
      }

      section.classList.add('is-visible');
      container.innerHTML = '';

      items.forEach(p => {
        const card = document.createElement('div');
        card.classList.add('related-product-card');

        const fullName  = p?.name || '';
        const shortName = fullName.length > 25 ? fullName.slice(0, 25) + '...' : fullName;

        const priceHtml = p?.special
          ? `<span class="related-price-old">${p.price || ''}</span>
             <span class="related-price-new">${p.special}</span>`
          : `<span class="related-price-normal">${p?.price || ''}</span>`;

        card.innerHTML = `
          <a href="${p?.href || '#'}" class="related-product-img">
            <img src="${p?.image || ''}" alt="${fullName.replace(/"/g,'&quot;')}" loading="lazy" />
          </a>
          <div class="related-product-name">
            <a href="${p?.href || '#'}" title="${fullName.replace(/"/g,'&quot;')}">${shortName}</a>
          </div>
          <div class="related-product-price">${priceHtml}</div>
        `;
        container.appendChild(card);
      });
    })
    .catch(() => {
      section.classList.remove('is-visible');
      container.innerHTML = '';
    });
})();
</script>
