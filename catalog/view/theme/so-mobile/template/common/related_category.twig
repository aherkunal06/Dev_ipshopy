<link rel="stylesheet" href="catalog/view/theme/so-mobile/stylesheet/recent_view.css">

<style>
/* ===============================
   ðŸŒŸ RECENTLY VIEWED CATEGORIES
   (Unique Class Version)
================================*/

/* Hide by default; show only when validated */
.recent-cat-section { 
  display: none; 
  margin: 24px 0; 
}
.recent-cat-section.is-visible { 
  display: block; 
}

/* Container box */
.recent-cat-box {
  background: #fff;
  border-radius: 10px;
  padding: 8px;
  /* box-shadow: 0 2px 6px rgba(0,0,0,0.08); */
}

/* Section title */
.recent-cat-title {
  font-size: 16px;
  font-weight: 600;
  color: #fff;
  background: linear-gradient(135deg, #1976d2, #2196f3);
  padding: 8px 14px;
  border-radius: 8px;
  margin-bottom: 10px;
  display: inline-block;
  letter-spacing: 0.3px;
}

/* Horizontal category list */
.recent-cat-grid {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding: 4px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
}
.recent-cat-grid::-webkit-scrollbar {
  display: none; /* Hide scrollbar for Chrome/Safari */
}

/* Category Card */
.recent-cat-card {
  flex: 0 0 calc(40%); /* ðŸ‘ˆ shows ~2.5 cards per screen */
  scroll-snap-align: start;
  background: #fff;
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 8px;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.08);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}
.recent-cat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 10px rgba(0,0,0,0.12);
}

/* Image */
.recent-cat-card img {
  width: 100%;
  height: 120px;
  object-fit: contain;
  display: block;
  border-radius: 8px;
  background: #fafafa;
}

/* Name */
.recent-cat-card h4 {
  font-size: 14px;
  margin: 6px 0 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: #222;
  font-weight: 500;
}

/* Price text */
.recent-cat-card p {
  font-size: 13px;
  margin: 0;
  opacity: .85;
  color: #555;
}

/* Responsive tweak: mobile view */
/* @media (max-width: 600px) {
  .recent-cat-card {
    flex: 0 0 calc(60%); 
  }
} */

/* Desktop view: 4 per row */
@media (min-width: 768px) {
  .recent-cat-card {
    flex: 0 0 calc(25% - 10px);
  }
}
</style>

<!-- ===============================
     HTML STRUCTURE (Unique Classes)
================================= -->
<div class="recent-cat-section">
  <div class="recent-cat-box">
    <div class="recent-cat-title">Recently Viewed Categories</div>
    <div id="recent-cat-container" class="recent-cat-grid"></div>
  </div>
</div>

<script>
(function(){
  const section   = document.querySelector('.recent-cat-section');
  const container = document.getElementById('recent-cat-container');
  if (!section || !container) return;

  // Hide until loaded
  section.classList.remove('is-visible');
  container.innerHTML = '';

  fetch('index.php?route=common/related_category/loadCategoryId')
    .then(res => res.json())
    .then(data => {
      const items = (data && Array.isArray(data.categories)) ? data.categories : [];

      // Hide if < 3 items
      if (items.length < 3) {
        section.classList.remove('is-visible');
        container.innerHTML = '';
        return;
      }

      // Show section
      section.classList.add('is-visible');
      container.innerHTML = '';

      items.forEach(cat => {
        const card = document.createElement('div');
        card.classList.add('recent-cat-card');

        const fullName  = cat?.category_name || '';
        const shortName = fullName.length > 20 ? fullName.slice(0, 20) + '...' : fullName;
        const img       = cat?.image || '';
        const path      = cat?.category_id ?? '';
        const price     = cat?.lowest_price ?? '';

        card.innerHTML = `
          <a href="index.php?route=product/category&path=${path}">
            <img src="${img}" alt="${fullName.replace(/"/g,'&quot;')}" loading="lazy" />
            <h4 title="${fullName.replace(/"/g,'&quot;')}">${shortName}</h4>
            <p>From: ${price}</p>
          </a>
        `;
        container.appendChild(card);
      });
    })
    .catch(() => {
      section.classList.remove('is-visible');
      container.innerHTML = '';
    });
})();
</script>
