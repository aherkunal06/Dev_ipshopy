{{ header }}
<link href="catalog/view/theme/so-mobile/css/Review/mobile_reviews.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="catalog/view/theme/so-mobile/css/product.css">
<div class="container page-category">
	
  <div class="row">{{ column_left }}
    
    <div id="content" class="col-xs-12">
    
		<div class="row product-view product-detail"> 
		
		{#========== Product Left ============#}
		<div class="content-product-left  col-xs-12">
			<div class="so-loadeding" ></div>
			{% if column_left  %}
				<a href="javascript:void(0)" class="btn btn-primary open-sidebar "><i class="fa fa-bars"></i>{{ text_sidebar }}</a>
				<div class="sidebar-overlay "></div>
			{% endif %}
			
			{% if images %}
				
				{#==== Gallery - Large image  ==== #}
				<div class="large-image ">
					<div class="box-label">
						{#===== New Label==============#}
						{% if soconfig.get_settings('new_status') and day_number_boolean %} 
							<span class="label-product label-new">{{ objlang.get('text_new')}} </span>
						{% endif %} 
						
						{#=======Discount Label======= #}
						{% if soconfig.get_settings('discount_status')  %} 
						{% if price  and  special  %} 
							<span class="label-product label-sale">
								 {{ discount }}
							</span>
						{% endif %} 
						{% endif %} 
					</div> 
					<img itemprop="image" class="product-image-zoom" src="{{popup}}" data-zoom-image="{{popup}}" title="{{ heading_title }}" alt="{{ heading_title }}" />
				</div>
				
				{#==== Gallery - Bottom Thumbnails ==== #}
				<div id="thumb-slider" class="full_slider contentslider contentslider--default" data-rtl="{{direction}}" data-autoplay="no"  data-pagination="no" data-delay="4" data-speed="0.6" data-margin="10"  data-items_column0="4" data-items_column1="3" data-items_column2="5"
				data-items_column3="4" data-items_column4="3" data-arrows="yes" data-lazyload="yes" data-loop="no" data-hoverpause="yes">
					{% for key,image in images %}
						<div class="image-additional">
						<a data-index="{{key}}" class="img thumbnail " data-image="{{image.popup}}" title="{{ heading_title }}">
							<img src="{{ image.thumb }}" title="{{ heading_title }}" alt="{{ heading_title }}" />
						</a>
						</div>
					{% endfor %}
					</ul>
				</div>
				
			{% endif %}
		</div>
        {#========== //Product Left ============#}

		{#========== Product Right ============#}
		<div class="content-product-right col-xs-12">
			
			
			{% if model %}
				<div class="model font-ct"><span>{{ text_model }} </span> {{ model }}</div>
			{% endif %}
					
			{% if review_status %}
			{#======== Review - Rating ========== #}
			<div class="box-review">
				<div class="rating">
					<div class="rating-box">
					{% for i in 1..5 %}
						{% if rating < i %}<span class="fa fa-stack"><i class="fa fa-star-o fa-stack-1x"></i></span>{% else %}<span class="fa fa-stack"><i class="fa fa-star fa-stack-1x"></i><i class="fa fa-star-o fa-stack-1x"></i></span>{% endif %}
					{% endfor %}
					</div>
				</div>
			</div>
			{% endif %}
		
			{% if price %}
			{#========= Product - Price ========= #}
			<div class="product_page_price price" itemprop="offerDetails" itemscope itemtype="http://data-vocabulary.org/Offer">
				{% if not special %}
			        <span class="price-new"><span itemprop="price" id="price-old">{{ price }}</span></span>
			     {% else %}
			        <span class="price-new"><span itemprop="price" id="price-special">{{ special }}</span></span>
				   <span class="price-old" id="price-old">{{ price }}</span>
			     {% endif %}
				
				 {% if tax %}
					<div class="price-tax"><span>{{ text_tax }}</span> {{ tax }}</div>
				{% endif %}
			
				{#{% if discounts %} #}
				{#	<ul class="list-unstyled	">#}
				{#	{% for discount in discounts %} #}
				{#		<li>{{ discount.quantity }} {{ text_discount }} {{ discount.price }} </li>#}
				{#	{% endfor %}#}
				{#	</ul>#}
				{#{% endif %} 	 #}
			</div>
				
			{% endif %}
			
			<div class="box-link">
				<div class="add-to-links wish_comp">
					<ul class="blank">
						{% if product_video %}
			           	<li class="compare"> <a class="thumb-video" href="{{product_video}}"><i class="fa fa-youtube-play fa-lg"></i> </a> </li>
			        	{% endif %}

			        	{% if soconfig.get_settings('wishlist_status') %} 
						<li class="wishlist">
							<a onclick="wishlist.add({{ product_id }});"><i class="fa fa-heart"></i></a>
						</li>
						{% endif %}

						{% if soconfig.get_settings('compare_status') %} 
						<li class="compare">
							<a onclick="compare.add({{ product_id }});"><i class="fa fa-retweet"></i></a>
						</li>
						{% endif %}
					</ul>
				</div>
			</div>
			{#option start#}
			<div id="product">	
				{% if options %} 
				<div class="options-mobi clearfix">
				
				{% for option in options %}
					{% if option.type == 'select' %}
					<div class="form-group{% if option.required %} required {% endif %}">
						<label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
						<select name="option[{{ option.product_option_id }}]" id="input-option{{ option.product_option_id }}" class="form-control width50">
							<option value="">{{ text_select }}</option>
						{% for option_value in option.product_option_value %}
							<option value="{{ option_value.product_option_value_id }}">{{ option_value.name }}
							{% if option_value.price %}
								({{ option_value.price_prefix }}{{ option_value.price }})
							{% endif %}
							</option>
						{% endfor %}
					  </select>
					</div>
					{% endif %}
					
					{% if option.type == 'radio' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  	<label class="control-label">{{ option.name }}</label>
						<div id="input-option{{ option.product_option_id }}">
							{% set radio_style 	 = soconfig.get_settings('radio_style') %}
							{% set radio_type 	 = radio_style ? ' radio-type-button':'' %}

							{% for option_value in option.product_option_value %} 
							{% set radio_image 	=  option_value.image ? 'option_image' : '' %} 
							{% set radio_price 	=  radio_style ? option_value.price_prefix ~ option_value.price : '' %} 
							
								<div class="radio {{ radio_image ~ radio_type }}">
									<label>							
										<input type="radio" name="option[{{ option.product_option_id }}]" value="{{ option_value.product_option_value_id }}" />
										<span class="option-content-box" data-title="{{ option_value.name}} {{ radio_price }}" data-toggle='tooltip'>
											{% if option_value.image %} 
												<img src="{{ option_value.image }} " alt="{{ option_value.name}}  {{radio_price}}" /> 
											{% endif %} 
											<span class="option-name">{{ option_value.name }} </span>
											{% if option_value.price  and  radio_style  != '1' %} ({{ option_value.price_prefix }} {{ option_value.price }} ){% endif %} 
										  
										</span>
									</label>
								</div>
							{% endfor %}	
							 
							{% if radio_style %} 
							<script type="text/javascript">
								 $(document).ready(function(){
									  $('#input-option{{ option.product_option_id }} ').on('click', 'span', function () {
										   $('#input-option{{ option.product_option_id }}  span').removeClass("active");
										   $(this).toggleClass("active");
									  });
								 });
							</script>
							{% endif %} 

						</div>
					</div>
					{% endif %}

					{% if option.type == 'checkbox' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  	<label class="control-label">{{ option.name }}</label>
					  	<div id="input-option{{ option.product_option_id }}">
							{% set radio_style 	 = soconfig.get_settings('radio_style') %}
							{% set radio_type 	 = radio_style ? ' radio-type-button':'' %}

							{% for option_value in option.product_option_value %} 
							{% set radio_image 	=  option_value.image ? 'option_image' : '' %} 
							{% set radio_price 	=  radio_style ? option_value.price_prefix ~ option_value.price : '' %} 
							
								<div class="checkbox  {{ radio_image ~ radio_type }}">
									<label>
										<input type="checkbox" name="option[{{ option.product_option_id }}][]" value="{{ option_value.product_option_value_id }}" />
										<span class="option-content-box" data-title="{{ option_value.name}} {{ radio_price }}" data-toggle='tooltip'>
											{% if option_value.image %} 
												<img src="{{ option_value.image }} " alt="{{ option_value.name}}  {{radio_price}}" /> 
											{% endif %} 

											<span class="option-name">{{ option_value.name }} </span>
											{% if option_value.price  and  radio_style  != '1' %} 
												({{ option_value.price_prefix }} {{ option_value.price }} )
											{% endif %} 
										  
										</span>
									</label>
								</div>
							{% endfor %}	
							 
							{% if radio_style %} 
							<script type="text/javascript">
								 $(document).ready(function(){
									  $('#input-option{{ option.product_option_id }} ').on('click', 'span', function () {
										   $(this).toggleClass("active");
									  });
								 });
							</script>
							{% endif %} 

						</div>
					</div>
					{% endif %}

					{% if option.type == 'text' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
					  <input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control" />
					</div>
					{% endif %}

					{% if option.type == 'textarea' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
					  <textarea name="option[{{ option.product_option_id }}]" rows="5" placeholder="{{ option.name }}" id="input-option{{ option.product_option_id }}" class="form-control">{{ option.value }}</textarea>
					</div>
					{% endif %}

					{% if option.type == 'file' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  <label class="control-label">{{ option.name }}</label>
					  <button type="button" id="button-upload{{ option.product_option_id }}" data-loading-text="{{ text_loading }}" class="btn btn-default btn-block"><i class="fa fa-upload"></i> {{ button_upload }}</button>
					  <input type="hidden" name="option[{{ option.product_option_id }}]" value="" id="input-option{{ option.product_option_id }}" />
					</div>
					{% endif %}

					{% if option.type == 'date' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
					  <div class="input-group date">
						<input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" data-date-format="YYYY-MM-DD" id="input-option{{ option.product_option_id }}" class="form-control" />
						<span class="input-group-btn">
						<button class="btn btn-default" type="button"><i class="fa fa-calendar"></i></button>
						</span></div>
					</div>
					{% endif %}

					{% if option.type == 'datetime' %}
					<div class="form-group{% if option.required %} required {% endif %}">
					  <label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
					  <div class="input-group datetime">
						<input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" data-date-format="YYYY-MM-DD HH:mm" id="input-option{{ option.product_option_id }}" class="form-control" />
						<span class="input-group-btn">
						<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
						</span></div>
					</div>
					{% endif %}
					
					{% if option.type == 'time' %}
					<div class="form-group{% if option.required %} required {% endif %}">
						<label class="control-label" for="input-option{{ option.product_option_id }}">{{ option.name }}</label>
						<div class="input-group time">
						<input type="text" name="option[{{ option.product_option_id }}]" value="{{ option.value }}" data-date-format="HH:mm" id="input-option{{ option.product_option_id }}" class="form-control" />
						<span class="input-group-btn">
						<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
						</span></div>
					</div>
					{% endif %}
					
				{% endfor %}
				</div>
				{% endif %}
				


				<div class="box-cart clearfix">
					{% if recurrings %}
					<h3>{{ text_payment_recurring }}</h3>
					<div class="form-group required">
						<select name="recurring_id" class="form-control">
						<option value="">{{ text_select }}</option>
						{% for recurring in recurrings %}
						<option value="{{ recurring.recurring_id }}">{{ recurring.name }}</option>
						{% endfor %}
						</select>
					  <div class="help-block" id="recurring-description"></div>
					</div>
					{% endif %}
				  
					<div class="form-group box-info-product">
						<div class="option quantity">
							<div class="input-group quantity-control">
								  <span class="input-group-addon product_quantity_down fa fa-minus"></span>
								  <input class="form-control" type="text" name="quantity" value="{{ minimum }}" />
								  <input type="hidden" name="product_id" value="{{ product_id }}" />								  
								  <span class="input-group-addon product_quantity_up fa fa-plus"></span>
							</div>
						</div>
						<div class="detail-action">
							{# =========button Cart ======#}
							<div class="cart">
									<input type="button" value="{{ button_cart }}" data-loading-text="{{ text_loading }}" id="button-cart" class="btn btn-mega">
									
									<input type="button"  value="Buy Now" data-loading-text="{{ text_loading }}" id="button-checkout" class="btn btn-checkout " />
							</div>
							
						</div>
					</div>

					<div class="clearfix"></div>
					{% if minimum > 1 %}
						<div class="alert alert-info"><i class="fa fa-info-circle"></i> {{ text_minimum }}</div>
					{% endif %}

					{% if soconfig.get_settings('product_page_button') and soconfig.get_settings('product_socialshare') %}
					<div class="form-group social-share clearfix">
						{{ soconfig.decode_entities( soconfig.get_settings('product_socialshare') ) }}
					</div>
					{% endif %}
					<!-- Go to www.addthis.com/dashboard to customize your tools -->
					<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-529be2200cc72db5"></script>

					{#{% if tags %}#}
				
					{#<div id="tab-tags" class="box-info-product">#}
				 {#       {{ text_tags }}#}
				 {#       {% for i in 0..tags|length %}#}
				 {#       {% if i < (tags|length - 1) %} <a class="btn btn-primary btn-sm" href="{{ tags[i].href }}">{{ tags[i].tag }}</a>#}
				 {#       {% else %} #}
				 {#       {% if tags[i] is not empty  %}#}
				 {#       <a class="btn btn-primary btn-sm 22" href="{{ tags[i].href }}">{{ tags[i].tag }}</a> {% endif %}#}
				 {#       {% endif %}#}
				 {#       {% endfor %} #}
				        
				 {#    	</div>#}
					{#{% endif %}#}

                 {# comment line 353 to 366 product tags remove from satyashil#}
				</div>

			</div>
				{#option end #}
		{#========= Product - discount ========= #}
				  				
				  {% if discounts %} 
				  <div class='discount_section'>
				      
						<table class="table" style='width : 60%;' >
							<thead>
								<tr>
									<th scope="col" class='text-left'>Quantity</th>
									{# <th scope="col">Discount</th> #}
									<th scope="col" class='text-left'>Discount Price</th>
								</tr>
							</thead>
							<tbody>
								{% for discount in discounts %}
								<tr>
									<td>{{ discount.quantity }} - {{ discount.max_quantity }}</td>
									{# <td></td> #}
									<td>₹{{ discount.price }}</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
				  </div>
					{% endif %}
                    {#discount table end #}
                    	{#variant starts#}
				{% if product_variants %}
					<div
						class="product-variants" style='display:flex; gap:10px;'>
						{# <h3>Available Variants</h3> #}
					{% for variant in product_variants %}
                    <div class="variant images">
                        {#{% for image in variant_images %}#}
                            <a href="index.php?route=product/product&product_id={{ variant.product_id }}">
                                <img src="{{ variant.image }}" alt="{{ variant.variant_name }}" width="60">
                            </a>
                        {#{% endfor %}#}
                    </div>
                {% endfor %}

				</div>
			{% endif %}
			{# variant ends  #}
 {#==== Pincode Delivery Check Section ==== #}
                    <div class="pincode-checker">
                      <label class="pincode-label">Delivery To</label>
                      <div class="pincode-input-wrapper">
                        <div class="pincode-input-group">
                          <input
                            type="text"
                            id="pincode-input"
                            placeholder="Enter 6-digit pincode"
                            maxlength="6"
                            value="{{ default_postcode }}"
                          />
                          <!-- value="{% if customer and customer.isLogged and addresses %}{% for address in addresses %}{% if address.default %}{{
                              address.postcode
                            }}{% endif %}{% endfor %}{% endif %}" -->
                          <button id="check-pincode" data-product-id="{{ product_id }}">
                            Check
                          </button>
                          <span id="pincode-loader" style="display: none">⟳</span>
                        </div>
                        <div class="pincode-dropdown">
                          {% if addresses %}
                          <div class="dropdown-section-title">Saved Addresses</div>
        
                          {# First show the default address if available #} {% for
                          address in addresses %} {% if address.default %}
                          <div
                            class="address-item selected"
                            data-pincode="{{ address.postcode }}"
                          >
                            <div class="address-title">
                              {{ address.firstname }}
                              {{ address.lastname }}
                              {{ address.address_1 }},
                              {{ address.address_2 }}
                              {{ address.city }}
                              {{ address.zone }}
                              {{ address.country }}
                              {{ address.custom_field[3] }} [Default]
                            </div>
                            <div class="address-pincode">{{ address.postcode }}</div>
                          </div>
                          {% endif %} {% endfor %} {# Then show the rest #} {% for
                          address in addresses %} {% if not address.default %}
                          <div
                            class="address-item"
                            data-pincode="{{ address.postcode }}"
                          >
                            <div class="address-title">
                              {{ address.firstname }}
                              {{ address.lastname }}
                              {{ address.address_1 }},
                              {{ address.address_2 }}
                              {{ address.city }}
                              {{ address.zone }}
                              {{ address.country }}
                              {{ address.custom_field[3] }}
                            </div>
                            <div class="address-pincode">{{ address.postcode }}</div>
                          </div>
                          {% endif %} {% endfor %} {% endif %}
        
                          <div class="dropdown-section-title">Recent Searches</div>
                          <div class="recent-pincodes"></div>
                        </div>
                      </div>
                      {#added for geolocation#}
                      <!-- Drop Location (clickable) -->
    				  <div id="location-info"  style="margin: 10px 0; font-weight: bold; color: #953a93;">
    						Fetching your location...
    				  </div>
    				  <div id="delivery-estimate-info" style="margin: 10px 0; font-weight: bold; color: green;">Fetching delivery estimate...</div>
    				  <div id="vendor-location-info" style="display:none;"></div>
                      <div class="pincode-error"></div>
                      <div class="pincode-success"></div>
                    </div>
    				{# ------------------------- pincode end ---------------------------------- #}
        		{#free condition #}
        		   {% if freeCharges %}
		              <div id="freeChargesCont">
                            Buy more than 
                            <strong id="freeCharges" style='font-size:14px;'>{{ freeCharges }}</strong>
                            items and get free shipping!
                      </div>
                    {% endif %}
                 {#free condition end #}
			{#<div class="product-box-desc">#}
			{#	<ul class="inner-box-desc">#}
			{#		{% if manufacturer %}#}
			{#			<li class="brand"><span>{{ text_manufacturer }} </span><a href="{{ manufacturers }}">{{ manufacturer }}</a></li>#}
			{#		{% endif %}#}
					
			{#		{% if reward %}#}
			{#			<li class="reward"><span>{{ text_reward }}</span> {{ reward }}</li>#}
			{#		{% endif %}#}
					
			{#		<li class="stock"><span>{{ text_stock }}</span> <i class="fa fa-check-square-o"></i>{{ stock }}</li>	#}
			{#	</ul>		#}
			{#</div>#}
				
					{# manufacturer and product code start #}
					<div class="product-box-desc" style='overflow:hidden; margin:5px; padding-top:0px;'>
    					<div class="inner-box-desc">
                            	{#to display seller name on there product page 03-05-2025#}
        				{% for vendor in vendor_info_list %}
        				    <div class='seller_name_section highlight_wrapper'>
        				    <span class='seller_name highlight_left'>Seller</span>
            				<a href='https://www.ipshopy.com/index.php?route=vendor/vendor_profile&vendor_id={{vendor.vendor_id}}' class='highlight_right'>{{ vendor.display_name ?: vendor.company }}</a>
        				    </div>
        				{% endfor %}
    						{% if manufacturer %}
    						<div class="brand highlight_wrapper" itemprop="brand" itemscope itemtype="http://schema.org/Brand">
    						<span class='highlight_left'>{{ text_manufacturer }} </span><a href="{{ manufacturers }}" itemprop="url" class='highlight_right'><span itemprop="name">{{ manufacturer }} </span></a></div>
    					{% endif %}
    						
    						{% if model %}
    						<div class="model highlight_wrapper" ><span class='highlight_left'>{{ text_model }} </span> <span class='highlight_right'>{{ model }}</span></div>
    						{% endif %}
    						
    						{% if reward %}
    							<div class="reward highlight_wrapper"><span class='highlight_left'>{{ text_reward }}</span> <span class='highlight_right'> {{ reward }}</span></div>
    						{% endif %}
    						{#key_highlight start #}
    						{% if key_highlight %}
							<div class="product-key-highlight highlight_wrapper">
								<h4 class='highlight_left' >Highlights</h4>
								<div class="highlight-content">
									<ul id="highlight-list">
										{% set lines = key_highlight|replace({'\r\n': '\n', '\r': '\n'})|split('\n') %}
										{% for item in lines %}
										{% set trimmed = item|trim %}
										{% if trimmed %}
										<li class="highlight-item">
											{{ trimmed }}
										</li>
										{% endif %}
										{% endfor %}
									</ul>
								</div>
							</div>
							{% endif %}
							{#key highlight end #}
    						{#<div class="stock"><span>{{ text_stock }}</span> <i class="fa fa-check-square-o"></i> {{ stock }}</div>	#}
    					</div>	
	
					{#<div class="inner-box-viewed ">#}
					{#	<span>{{ text_viewed }}</span> <i class="fa fa-eye" ></i> {{ viewed }}#}
					{#</div>	#}
					
				</div>
					{# manufacturer and product code end #}
					
					{#warranty and return policy start #}
                            <div class='additional_btns' style='position:relative'>
                                	<!-- replacement starts -->

								
								<!-- replacement starts -->

								{% if replacement_policy and replacement_policy.is_replacable == '1' %}
								<button type="button" class="btn additional_btn" onclick="openModal('replacement')">
									<i class="fa fa-refresh" aria-hidden="true"></i>
									<p>{{ replacement_policy.replacement_period }} days Replacement</p>
								</button>
								{% elseif replacement_policy and replacement_policy.is_replacable == '0'  %}
								<button type="button" class="btn additional_btn" onclick="openModal('replacement')">
									<i class="fa fa-refresh" aria-hidden="true"></i>
									<p>Not Replaceable</p>
								</button> 
								{% endif %}
								<!-- replacement ends -->



								{% if product_warranty and product_warranty.is_warranty == '1' %}
								<button type="button" class="btn additional_btn" onclick="openModal('warranty')">
									<i class="fa fa-shield" aria-hidden="true"></i>
									<p>{{ product_warranty.warranty_duration }} months Warranty</p>
								</button>
								{% elseif product_warranty and product_warranty.is_warranty == '0' %}
								
								<button type="button" class="btn additional_btn" onclick="openModal('warranty')">
								<i class="fa fa-shield" aria-hidden="true"></i>
								<p>No Warranty</p>
								</button> 
								
								{% endif %}

								{% if product_return and product_return.is_returnable == '1' %}
								<button type="button" class="btn additional_btn" onclick="openModal('return')">
									<i class="fa fa-undo" aria-hidden="true"></i>
									<p>{{ product_return.return_duration_period }} days Return</p>
								</button>
								{% elseif product_return and product_return.is_returnable == '0' %}
								
									<button type="button" class="btn additional_btn" onclick="openModal('return')">
									<i class="fa fa-undo" aria-hidden="true"></i>
									<p>No Return</p>
									</button> 
								
								{% endif %}
							<div>
							    <button type='button' class='btn additional_btn' onclick="openModal('cash')">
    							    <i class="fa fa-truck" aria-hidden="true"></i>
							    <p>Cash on Delivery</p>
							    </button>
							</div>
								<!-- Modal Overlay -->
							<div id="modalOverlay" class="modal-overlay">
							    <!-- Replacement Modal -->
									<div id="replacementModal" class="modal-popup product_model" style="display: none;">
										<button class="modal-close product_model_close"
											onclick="closeModal()">&times;</button>

										{% if replacement_policy and replacement_policy.is_replacable == '1' %}
										<h4>{{ replacement_policy.replacement_period }} Days Replacement</h4>
										<table class="replacement-table">
											<thead>
												<tr>
													<th>Replacement Reason</th>
													<th>Replacement Period</th>
													<th>Replacement Policy</th>
												</tr>
											</thead>
											<tbody>
												<tr>
													<td>{{ replacement_policy.replacement_reason }}</td>
													<td>{{ replacement_policy.replacement_period }} days from delivery
													</td>
													<td>{{ replacement_policy.replacement_policy }}</td>
												</tr>
											</tbody>
										</table>
										<div class="replacement-description">
											<p><strong>Replacement Description:</strong></p>
											<p>{{ replacement_policy.replacement_description }}</p>
										</div>
										{% else %}
										<h4>Replacement Details</h4>
										<p style="color: #a00; font-size: 14px; margin-top: 10px; font-weight: 500;">
											This product is not eligible for replacement.
										</p>
										{% endif %}
									</div>

                                {#replacement end #}
								<!-- Warranty Modal -->
								<div id="warrantyModal" class="modal-popup product_model " style="display: none;">
									<button class="modal-close product_model_close" onclick="closeModal()">&times;</button>
									<h4>Warranty Details</h4>
									 {% if has_warranty %} 
									<p><strong>Warranty By:</strong> {{ warranty_by|capitalize }}</p>
									<p><strong>Duration:</strong> {{ warranty_duration }} month(s)</p>
									<p><strong>Description:</strong> {{ warranty_description }}</p>
									{% else %}
									<p>Warranty is not applicable on this product.</p>
									{% endif %}
								</div>
                            {#warranty model end #}
									<!-- Return Policy Modal -->
    							<div id="returnModal" class="modal-popup product_model" style="display: none;">
    								<button class="modal-close product_model_close" onclick="closeModal()">&times;</button>
    							    {% if is_returnable %}
    								<h4>Return Policy</h4>
    								<p><strong>Returnable:</strong> <span style="color: green;">Yes</span></p>
    								<p><strong>Return Duration:</strong> {{ return_duration_period }} day(s)</p>
    								<p><strong>Return Policy Details:</strong><br> {{ return_policy_details}}</p>
    								{% else %}
    								<p>Return is not applicable on this product.</p>
    								{% endif %}
    							</div>
    							{#cash on delivery modal #}
    							<div id="cashModal" class="modal-popup product_model" style="display: none;">
    								<button class="modal-close product_model_close" onclick="closeModal()">&times;</button>
    							    {% if is_cash %}
    								<h4>Cash on Delivery</h4>
    								<p>The product is eligible for Cash on Delivery.</p>
    								{% else %}
    								
    								<p>The product is eligible for Cash on Delivery.</p>
    								{% endif %}
    							</div>
							</div>
                            </div>
								
						{#warranty and return policy ends #}
					<!-- faq start  -->
							{% if product_faqs and product_faqs|length > 0 %}
							<div class="product-faqs-section">
								<h3>Frequently Asked Questions</h3>
								<div class="product-faqs">
									{% for faq in product_faqs %}
									<div class="faq-item" {% if loop.index> 4 %}style="display: none;"
										class="extra-faq"{% endif %}>
										<div class="faq-question">
											{% set qmark = faq.question|trim|slice(-1) == '?' ? '' : '?' %}
											<strong>Q {{ faq.question|trim }} {{ qmark }}</strong>
										</div>
										<div class="faq-answer">
											<span>A :</span> {{ faq.answer }}
										</div>
									</div>
									{% endfor %}
								</div>

								{% if product_faqs|length > 4 %}
								<div class="faq-toggle-buttons">

									<button onclick="window.location.href='{{ url_all_faqs }}'" class="btn btn-link">All
										Questions</button>

									<!-- <button id="show-more-faqs" class="btn btn-link">Show More</button> -->
									<!-- <button id="show-less-faqs" class="btn btn-link" style="display: none;">Show
										Less</button> -->
								</div>
								{% endif %}
							</div>
							{% endif %}


							<button type="button" class="btn btn-primary pull-right" id="ask-question-btn">Ask a Question</button>


							<!-- Ask Question Modal -->
							<div id="askQuestionModal" class="modal fade">
								<div class="modal-dialog modal-lg">
									<div class="modal-content ask-question-modal">

										{% if is_logged %}
										<div class="modal-body p-0">
											<div class="row ask-question-modal-body">
												<!-- Left panel -->
												<div
													class="col-md-5 ask-left-panel p-4 d-flex flex-column justify-content-center">
													<ul class="ask-guidelines list-unstyled">
														<li>• Be specific, ask questions only about the product.</li>
														<li class="mt-2">• Review product specs before posting.</li>
														<li class="mt-2">• For orders/offers, contact customer support.
														</li>
													</ul>
												</div>

												<!-- Right panel -->
												<div class="col-md-7 ask-right-panel p-4 position-relative">
													<button type="button" class="close position-absolute"
														style="margin-top:0px; right:10px;"
														data-dismiss="modal">&times;</button>
													<h5 class="mb-3 font-weight-bold">Post your question</h5>
													<form id="ask-question-form">
														<textarea name="question" id="faq-question"
															class="form-control mb-3" required
															placeholder="Type your question here..."
															rows="5"></textarea>
														<input type="hidden" name="product_id" value="{{ product_id }}">
														<div class="text-right">
															<button type="submit"
																class="btn ask-submit-btn">SUBMIT</button>
														</div>
													</form>
												</div>
											</div>
										</div>

										{% else %}
										<!-- Not logged in -->

										<div class="modal-header">
											<h5 class="modal-title">Login Required</h5>
											<button type="button" class="close" data-dismiss="modal">&times;</button>
										</div>
										<div class="modal-body text-center px-4 py-5">
											<div class="ask-login-outer">
												<p>{{ text_login2|raw }}</p>
											</div>
										</div>
										{% endif %}

									</div>
								</div>
							</div>
							<!-- faq end -->
				
				
		</div>
		{#========== //Product Right ============#}

		<div class="content-product-midde clearfix">
			{#========== TAB BLOCK ============#}
			{% set tabs_position	= soconfig.get_settings('tabs_position')  %}
			{% set showmore			= soconfig.get_settings('product_enableshowmore')  %}
			{% if showmore %} {% set class_showmore = 'showdown' %}
			{% else %} {% set class_showmore = 'showup' %}
			{% endif %}
			<div class="producttab ">
				<div class="tabsslider col-xs-12">
					{#========= Tabs - Bottom horizontal =========#}
					<ul class="nav nav-tabs font-sn">
						{#<li class="active"><a data-toggle="tab" href="#tab-description">{{ tab_description }}</a></li>#}

			            {#{% if review_status %}#}
			           	{# <li><a href="#tab-review" data-toggle="tab">{{ tab_review }}</a></li>#}
			            {#{% endif %}#}

			            {% if soconfig.get_settings('product_enableshipping') %}
						 <li><a href="#tab-contentshipping" data-toggle="tab">{{ tab_shipping}}</a></li>
						{% endif %}

						{% if product_tabtitle %}
			           	 <li><a href="#tab-customhtml" data-toggle="tab">{{ product_tabtitle}}</a></li>
			            {% endif %}

						
					</ul>

			
					<div class="tab-content col-xs-12">
						<div class="tab-pane active" id="tab-description">
							{#{% if attribute_groups %}#}
							{#	<h3 class="product-property-title" > {{text_product_specifics}}</h3>#}
				   {#           	<ul class="product-property-list util-clearfix">#}
					  {#              {% for attribute_group in attribute_groups %}#}
					               
					                	
						 {#               {% for attribute in attribute_group.attribute %}#}
						 {#               <li class="property-item">#}
						 {#                 <span class="propery-title">{{ attribute.name }}</span>#}
						 {#                 <span class="propery-des">{{ attribute.text }}</span>#}
						 {#               </li>#}
						 {#               {% endfor %}#}
					                 	
					  {#              {% endfor %}#}
				   {#           	</ul>#}
				   {#         {% endif %}#}


                            {% if attribute_groups %}
                              <h3 class="product-property-title">{{ text_product_specifics }}</h3>
                              <ul class="product-property-list util-clearfix">
                                {% for attribute_group in attribute_groups %}
                                  {% for attribute in attribute_group.attribute %}
                                    <li class="property-item">
                                      <span class="propery-title">{{ attribute.name }}</span>
                                      <span class="propery-des">{{ attribute.text }}</span>
                                    </li>
                                  {% endfor %}
                                {% endfor %}
                              </ul>
                            {% endif %}
                            
				            <h3 class="product-property-title" > {{text_product_description}}</h3>
				            {# REPLACED class_showmore/desc-collapse with proper clamping class #}
    							<div id="collapse-description" class="description-content">
    								{{ description }}
    							</div>
    
    							{% if showmore %}
    								<div class="button-toggle">
    									<a class="showmore" href="#" aria-expanded="false">
    										<span class="toggle-more">{{ objlang.get('show_more') }}
    											<i class="fa fa-angle-down"></i>
    										</span>
    										<span class="toggle-less">{{ objlang.get('show_less') }}
    											<i class="fa fa-angle-up"></i>
    										</span>
    									</a>
    								</div>
    							{% endif %}
				   {#         <div id="collapse-description" class="desc-collapse {{class_showmore}}">#}
							{#	{{ description }}#}
							{#</div>	#}

							{#{% if showmore %}#}
							{#<div class="button-toggle">#}
						 {#        <a class="showmore" data-toggle="collapse" href="#" aria-expanded="false" aria-controls="collapse-footer">#}
						 {#           <span class="toggle-more">{{ objlang.get('show_more') }} <i class="fa fa-angle-down"></i></span> #}
						 {#           <span class="toggle-less">{{ objlang.get('show_less') }} <i class="fa fa-angle-up"></i></span>           #}
							{#	</a>        #}
							{#</div>#}
							{#{% endif %}#}

						</div>
						

			            {#{% if review_status %}#}
			            {#<div class="tab-pane" id="tab-review">#}
				           {# <form  id="form-review">#}
				           {#     <div id="review"></div>#}
				           {#     <h3 class="modtitle">{{ text_write }}</h3>#}
				           {#     {% if review_guest %}#}
				           {#     <div class="form-group required">#}
				                  
				           {#         <label class="control-label" for="input-name">{{ entry_name }}</label>#}
				           {#         <input type="text" name="name" value="{{ customer_name }}" id="input-name" class="form-control" />#}
				                 
				           {#     </div>#}
				           {#     <div class="form-group required">#}
				                  
				           {#         <label class="control-label" for="input-review">{{ entry_review }}</label>#}
				           {#         <textarea name="text" rows="5" id="input-review" class="form-control"></textarea>#}
				           {#         <div class="help-block">{{ text_note }}</div>#}
				                
				           {#     </div>#}
				           {#     <div class="form-group required">#}
				                 
				           {#         <label class="control-label">{{ entry_rating }}</label>#}
				           {#         &nbsp;&nbsp;&nbsp; {{ entry_bad }}&nbsp;#}
				           {#         <input type="radio" name="rating" value="1" />#}
				           {#         &nbsp;#}
				           {#         <input type="radio" name="rating" value="2" />#}
				           {#         &nbsp;#}
				           {#         <input type="radio" name="rating" value="3" />#}
				           {#         &nbsp;#}
				           {#         <input type="radio" name="rating" value="4" />#}
				           {#         &nbsp;#}
				           {#         <input type="radio" name="rating" value="5" />#}
				           {#         &nbsp;{{ entry_good }}#}
				           {#     </div>#}
				           {#     {{ captcha }}#}
				               
				           {#       <div class="form-group">#}
				           {#         <button type="button" id="button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary">{{ button_continue }}</button>#}
				           {#       </div>#}
				               
				           {#     {% else %}#}
				           {#     {{ text_login }}#}
				           {#     {% endif %}#}
				           {# </form>#}
			            {#</div>#}
			            {#{% endif %}#}
			            

{# New Changes Added #}



					           		
{% if review_status %}
<div id="review_product-review-section" style="margin-top: 30px; position: relative;">

    <div class="review-section-header d-flex justify-content-between align-items-center mb-3">
        <h3 class="product-property-title review_product-property-title m-0">{{ tab_review }}</h3>

        {#<button type="button" id="review_openReviewPopup" class="btn btn-primary">#}
        
        {#    {{ text_write }}#}
        {#</button>#}
        <button type="button" id="review_openReviewPopup" class="btn btn-primary">
            {% if has_existing_review %}
                {# Edit Review #}
        		{{ text_edit_review }}
            {% else %}
                {{ text_write }}
            {% endif %}
        </button>
    </div>

    <!-- Loaded Reviews -->
    <div id="review"></div>

    <!-- Review Popup -->
    <div id="review_reviewPopupOverlay" class="popup-overlay review_popup-overlay" style="display: none;">
        <div class="popup-content review_popup-content">
            <div class="popup-header review_popup-header">
                <h5 class="popup-title review_popup-title">{{ text_write }}</h5>
                <button type="button" id="review_closeReviewPopup" class="popup-close review_popup-close">&times;</button>
            </div>

            <div class="popup-body review_popup-body">
                <form class="needs-validation review_needs-validation" id="review_form-review" enctype="multipart/form-data" novalidate>
                    {% if review_guest %}
                        <!-- Name -->
                        <div class="mb-3 form-group review_form-group required">
                            <label for="input-name" class="form-label review_form-label label-style review_label-style control-label review_control-label">{{ entry_name }}</label>
                            <input type="text" class="form-control review_form-control" id="review_input-name" name="name" value="{{ customer_name }}" required readonly >
                            <div id="review_error-name" class="error review_error small mt-1"></div>
                        </div>

                        <!-- Review Text -->
                        <div class="mb-3 form-group review_form-group required">
                            <label for="input-review" class="form-label review_form-label label-style review_label-style control-label review_control-label">{{ entry_review }}</label>
                            <textarea class="form-control review_form-control" id="review_input-review" name="text" rows="5" required>{{ customer_review_text }}</textarea>
                            <div id="review_error-review" class="error review_error small mt-1"></div>
                        </div>

                        <!-- Rating -->
                        <div class="mb-3 review_form-group required">
                            <label class="form-label review_form-label label-style review_label-style control-label review_control-label">{{ entry_rating }}</label>
                            <div class="d-flex align-items-center gap-2">
                                <div id="review_rating-stars" class="d-flex align-items-center gap-1">
                                    {{ entry_bad }}
                                    {% for i in 1..5 %}
                                        <i class="fa fa-star-o review_rating-star" data-value="{{ i }}" id="review_star{{ i }}" style="font-size: 1.8rem; cursor: pointer;"></i>
                                    {% endfor %}
                                    {{ entry_good }}
                                </div>
                                <input type="hidden" name="rating" id="review_rating-value" value="{{ customer_review_rating }}" required>
                            </div>
                            <div id="review_error-rating" class="error review_error small mt-1"></div>
                        </div>

                    


<!-- Image Upload -->
<div class="mb-3 review_form-group required">
  <label class="form-label review_form-label label-style review_label-style control-label review_control-label">
   Add Images (Max 5)
  </label>
  <div id="review_image-upload-wrapper" class="d-flex flex-wrap gap-2 border rounded p-2" style="min-height: 60px;"></div>
  <div id="review_error-images" class="error review_error small mt-1"></div>
</div>

{% if existing_review_images is defined %}
  <script>
    window.existingReviewImages = {{ existing_review_images|json_encode|raw }};
  </script>
{% else %}
  <script>
    window.existingReviewImages = [];
  </script>
{% endif %}





                        {% if existing_review_images %}
                        <script>
                          window.existingReviewImages = {{ existing_review_images|json_encode|raw }};
                        </script>
                        {% endif %}

                        <!-- Captcha -->
                        <div class="mb-3">
                            {{ captcha }}
                        </div>

                        <!-- Success Message -->
                        <div id="review_review-success" class="alert alert-success" style="display: none; margin-top: 10px;">
                            Saved Successfully
                        </div>

                        <!-- Submit Button -->
                        <div class="text-end">
                            <button type="button" id="review_button-review" data-loading-text="{{ text_loading }}" class="btn btn-primary">
                                {{ button_submit_review }}
                            </button>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">{{ text_login }}</div>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

{#review end #}

			            {% if soconfig.get_settings('product_enableshipping') and soconfig.get_settings('product_contentshipping') %}
							<div class="tab-pane" id="tab-contentshipping">
								{{ soconfig.decode_entities( soconfig.get_settings('product_contentshipping') ) }}
						</div>
						{% endif %}

						{% if product_tabtitle %}
						<div class="tab-pane " id="tab-customhtml">{{ product_tabcontent }}</div>
						{% endif %}
			           

					</div>
				</div>
			</div>
			

		</div>

		{% if products %}
		<div class="content-product-bottom clearfix">
			{% include theme_directory~'/template/soconfig/related_product.twig' %}
		</div>
		{% endif %}

	</div> 

    	{# {{ content_bottom }} #}
    </div>
    {{ column_right }}
    </div>
</div>

<script type="text/javascript">
<!--
$('select[name=\'recurring_id\'], input[name="quantity"]').change(function(){
	$.ajax({
		url: 'index.php?route=product/product/getRecurringDescription',
		type: 'post',
		data: $('input[name=\'product_id\'], input[name=\'quantity\'], select[name=\'recurring_id\']'),
		dataType: 'json',
		beforeSend: function() {
			$('#recurring-description').html('');
		},
		success: function(json) {
			$('.alert-dismissible, .text-danger').remove();

			if (json['success']) {
				$('#recurring-description').html(json['success']);
			}
		}
	});
});
//--></script>

<script type="text/javascript"><!--
$('#button-cart').on('click', function() {
	$.ajax({
		url: 'index.php?route=extension/soconfig/cart/add',
		type: 'post',
		data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea'),
		dataType: 'json',
		beforeSend: function() {
			$('#button-cart').button('loading');
		},
		complete: function() {
			$('#button-cart').button('reset');
		},
		success: function(json) {
			$('.alert').remove();
			$('.text-danger').remove();
			$('.form-group').removeClass('has-error');
			if (json['error']) {
				if (json['error']['option']) {
					for (i in json['error']['option']) {
						var element = $('#input-option' + i.replace('_', '-'));
						
						if (element.parent().hasClass('input-group')) {
							element.parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						} else {
							element.after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						}
					}
				}
				
				if (json['error']['recurring']) {
					$('select[name=\'recurring_id\']').after('<div class="text-danger">' + json['error']['recurring'] + '</div>');
				}
				
				// Highlight any found errors
				$('.text-danger').parent().addClass('has-error');
			}
			
			if (json['success']) {
			
				$('#wrapper').before('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="fa fa-close close" data-dismiss="alert"></button></div>');
				$('#cart  .total-shopping-cart ').html(json['total'] );
				$('#cart > ul').load('index.php?route=common/cart/info ul li');
				$('.text-danger').remove();
				timer = setTimeout(function () {
					$('.alert').addClass('fadeOut');
				}, 4000);
			}
			
		
		},
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
	});
});

$('#button-checkout').on('click', function() {
	$.ajax({
		url: 'index.php?route=checkout/cart/add',
		type: 'post',
		data: $('#product input[type=\'text\'], #product input[type=\'hidden\'], #product input[type=\'radio\']:checked, #product input[type=\'checkbox\']:checked, #product select, #product textarea'),
		dataType: 'json',
		beforeSend: function() {
			$('#button-checkout').button('loading');
		},
		complete: function() {
			$('#button-checkout').button('reset');
		},
		success: function(json) {
			$('.alert').remove();
			$('.text-danger').remove();
			$('.form-group').removeClass('has-error');

			if (json['error']) {
				if (json['error']['option']) {
					for (i in json['error']['option']) {
						var element = $('#input-option' + i.replace('_', '-'));
 
						 {% if option_data %} 
						 if(ProductOptionId != undefined && ProductOptionId==i.replace('_', '-')){ 
						 $('.so-colorswatch-productpage-icons').after('<div class="text-danger">' + json['error']['option'][i] + '</div>'); 
						 } 
						 {% endif %} 
 
						
						if (element.parent().hasClass('input-group')) {
							element.parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						} else {
							element.after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
						}
					}
				}
				
				if (json['error']['recurring']) {
					$('select[name=\'recurring_id\']').after('<div class="text-danger">' + json['error']['recurring'] + '</div>');
				}
				
				// Highlight any found errors
				$('.text-danger').parent().addClass('has-error');
			}

			if (json['success']) {
				$('.text-danger').remove();
				$('#cart  .total-shopping-cart ').html(json['total'] );
				 window.location.href = "index.php?route=checkout/checkout";
			}
		},
        error: function(xhr, ajaxOptions, thrownError) {
            alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
        }
	});
});
//--></script> 

<script type="text/javascript"><!--
$('.date').datetimepicker({
	language: document.cookie.match(new RegExp('language=([^;]+)'))[1],
	pickTime: false
});

$('.datetime').datetimepicker({
	language: document.cookie.match(new RegExp('language=([^;]+)'))[1],
	pickDate: true,
	pickTime: true
});

$('.time').datetimepicker({
	language: document.cookie.match(new RegExp('language=([^;]+)'))[1],
	pickDate: false
});

$('button[id^=\'button-upload\']').on('click', function() {
	var node = this;

	$('#form-upload').remove();

	$('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file" /></form>');

	$('#form-upload input[name=\'file\']').trigger('click');

	if (typeof timer != 'undefined') {
		clearInterval(timer);
	}

	timer = setInterval(function() {
		if ($('#form-upload input[name=\'file\']').val() != '') {
			clearInterval(timer);

			$.ajax({
				url: 'index.php?route=tool/upload',
				type: 'post',
				dataType: 'json',
				data: new FormData($('#form-upload')[0]),
				cache: false,
				contentType: false,
				processData: false,
				beforeSend: function() {
					$(node).button('loading');
				},
				complete: function() {
					$(node).button('reset');
				},
				success: function(json) {
					$('.text-danger').remove();

					if (json['error']) {
						$(node).parent().find('input').after('<div class="text-danger">' + json['error'] + '</div>');
					}

					if (json['success']) {
						alert(json['success']);

						$(node).parent().find('input').val(json['code']);
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
		}
	}, 500);
});
//--></script> 




{# New Changes Added #}


<script>
// let currentOpenModal = null;

document.addEventListener('DOMContentLoaded', function() {
    const ratingValue = parseInt(document.getElementById('review_rating-value').value || 0);
    if (ratingValue > 0) {
        for (let i = 1; i <= 5; i++) {
            const star = document.getElementById('review_star' + i);
            if (star) {
                if (i <= ratingValue) {
                    // Switch to filled star
                    star.classList.remove('fa-star-o');
                    star.classList.add('fa-star');
                    // Color in #ffc107 (gold)
                    star.style.color = '#ffc107';
                } else {
                    // Ensure stars after rating are empty + reset color
                    star.classList.remove('fa-star');
                    star.classList.add('fa-star-o');
                    star.style.color = '';
                }
            }
        }
    }
});
</script>


<script>

	document.addEventListener('DOMContentLoaded', function () {

const stars = document.querySelectorAll('.review_rating-star');

const ratingInput = document.getElementById('review_rating-value');

stars.forEach(star => {

star.addEventListener('click', function () {

const rating = parseInt(this.dataset.value);
ratingInput.value = rating;

stars.forEach(s => {

const value = parseInt(s.dataset.value);
if (value <= rating) {

s.classList.remove('fa-star-o');
s.classList.add('fa-star');
} else {

s.classList.remove('fa-star');
s.classList.add('fa-star-o');
}
})
})
})
})


document.addEventListener('DOMContentLoaded', function () {
const openBtn = document.getElementById('review_openReviewPopup');
const closeBtn = document.getElementById('review_closeReviewPopup');
const popupOverlay = document.getElementById('review_reviewPopupOverlay');

if (openBtn && popupOverlay) {
openBtn.addEventListener('click', function () {
popupOverlay.style.display = 'block';
});
}

if (closeBtn && popupOverlay) {
closeBtn.addEventListener('click', function () {
popupOverlay.style.display = 'none';
});
}
});


document.addEventListener("DOMContentLoaded", function () {
const toggleBtn = document.querySelector(".button-toggle .showmore");
const description = document.querySelector(".description-content");
const toggleContainer = document.querySelector(".button-toggle");

if (toggleBtn && description && toggleContainer) {
toggleBtn.addEventListener("click", function (e) {
e.preventDefault();
description.classList.toggle("expanded");
toggleContainer.classList.toggle("active");
});
}
});
</script>


<script>

const openPopupBtn = document.getElementById('review_openReviewPopup');
const closePopupBtn = document.getElementById('review_closeReviewPopup');
const popupOverlay = document.getElementById('review_reviewPopupOverlay');

let scrollPosition = 0;

openPopupBtn.addEventListener('click', function () {
// Save current scroll position
scrollPosition = window.scrollY;

// Lock scroll
document.body.style.position = 'fixed';
document.body.style.top = `-${scrollPosition}px`;
document.body.style.left = '0';
document.body.style.right = '0';
document.body.style.width = '100%';
document.body.style.overflow = 'hidden';

// Show popup
popupOverlay.style.display = 'flex';
});

function closePopup() {
// Hide popup
popupOverlay.style.display = 'none';

// Unlock scroll
document.body.style.position = '';
document.body.style.top = '';
document.body.style.left = '';
document.body.style.right = '';
document.body.style.width = '';
document.body.style.overflow = '';

// Restore scroll position
window.scrollTo(0, scrollPosition);
}

closePopupBtn.addEventListener('click', closePopup);
popupOverlay.addEventListener('click', function (e) {
if (e.target === this) 
closePopup();

});

</script>


{# New Changes Added #}

<script>
document.addEventListener('DOMContentLoaded', function () {
  const container = document.getElementById('review_image-upload-wrapper');
  const maxImages = 5;
  let imageCount = 0;

  function createImageBoxFromFile(file) {
    if (imageCount >= maxImages) return;
    if (!file || !file.type.startsWith('image/')) {
      showError('Only image files allowed.');
      return;
    }

    const wrapper = document.createElement('div');
    wrapper.className = 'review-image-wrapper';
    wrapper.style.cssText = 'margin:2px; padding:2px; width:90px; height:90px; position:relative;';

    const thumbnail = document.createElement('div');
    thumbnail.className = 'img-thumbnail';
    thumbnail.style.cssText = 'width:90px; height:90px; display:flex; align-items:center; justify-content:center; cursor:pointer; border:2px dashed #aaa; border-radius:8px; background:#fdfdfd; overflow:hidden;';

    const img = document.createElement('img');
    img.alt = 'Preview';
    img.style.cssText = 'max-height:100%; max-width:100%; display:none;';
    thumbnail.appendChild(img);

    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.name = 'review_images[]';
    fileInput.accept = 'image/*';
    fileInput.style.display = 'none';

    wrapper.appendChild(thumbnail);
    wrapper.appendChild(fileInput);

    container.insertBefore(wrapper, document.getElementById('review_add-new-box'));

    const reader = new FileReader();
    reader.onload = function (e) {
      img.src = e.target.result;
      img.style.display = 'block';
    };
    reader.readAsDataURL(file);

    thumbnail.addEventListener('click', () => fileInput.click());

    fileInput.files = createFileList(file); // preserve file for form
    addRemoveButton(wrapper, '');

    imageCount++;
    updateAddButton();
  }

  function createFileList(file) {
    const dataTransfer = new DataTransfer();
    dataTransfer.items.add(file);
    return dataTransfer.files;
  }

  function createImageBox(imageSrc = '', existingFilename = '') {
    if (imageCount >= maxImages) return;

    const wrapper = document.createElement('div');
    wrapper.className = 'review-image-wrapper';
    wrapper.style.cssText = 'margin:2px; padding:2px; width:90px; height:90px; position:relative;';

    const thumbnail = document.createElement('div');
    thumbnail.className = 'img-thumbnail';
    thumbnail.style.cssText = 'width:90px; height:90px; display:flex; align-items:center; justify-content:center; cursor:pointer; border:2px dashed #aaa; border-radius:8px; background:#fdfdfd; overflow:hidden;';

    const img = document.createElement('img');
    img.alt = 'Preview';
    img.style.cssText = 'max-height:100%; max-width:100%; display:' + (imageSrc ? 'block' : 'none') + ';';
    if (imageSrc) img.src = imageSrc;

    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.name = 'review_images[]';
    fileInput.accept = 'image/*';
    fileInput.style.display = 'none';

    thumbnail.appendChild(img);
    wrapper.appendChild(thumbnail);
    wrapper.appendChild(fileInput);

    if (existingFilename) {
      const existingInput = document.createElement('input');
      existingInput.type = 'hidden';
      existingInput.name = 'existing_images[]';
      existingInput.value = existingFilename;
      wrapper.appendChild(existingInput);
    }

    container.insertBefore(wrapper, document.getElementById('review_add-new-box'));

    thumbnail.addEventListener('click', () => fileInput.click());

    addRemoveButton(wrapper, existingFilename);

    fileInput.addEventListener('change', function (event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function (e) {
          img.src = e.target.result;
          img.style.display = 'block';
        };
        reader.readAsDataURL(file);

        const existingInput = wrapper.querySelector('input[name="existing_images[]"]');
        if (existingInput) existingInput.remove();
      } else {
        showError('Only image files allowed.');
      }
    });

    imageCount++;
    updateAddButton();
  }

  function addRemoveButton(wrapper, existingFilename) {
    const btn = document.createElement('button');
    btn.textContent = '×';
    btn.className = 'remove-btn';
    btn.style.cssText = `
      position: absolute;
      top: 2px;
      right: 6px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 16px;
      font-weight: bold;
      font-family: Arial, sans-serif;
      line-height: 1;
      padding: 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    `;
    wrapper.appendChild(btn);

    btn.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();

      if (existingFilename) {
        const deletedInput = document.createElement('input');
        deletedInput.type = 'hidden';
        deletedInput.name = 'deleted_review_images[]';
        deletedInput.value = existingFilename;
        document.getElementById('review_form-review').appendChild(deletedInput);
      }

      wrapper.remove();
      imageCount--;
      updateAddButton();
    });
  }

  function updateAddButton() {
    const existingAddBox = document.getElementById('review_add-new-box');
    if (imageCount >= maxImages) {
      if (existingAddBox) existingAddBox.remove();
    } else {
      if (!existingAddBox) createAddButton();
    }
  }

  function createAddButton() {
    const wrapper = document.createElement('div');
    wrapper.style.cssText = 'margin:2px; padding:2px; width:90px; height:90px; cursor:pointer;';
    wrapper.id = 'review_add-new-box';

    const thumbnail = document.createElement('div');
    thumbnail.className = 'img-thumbnail';
    thumbnail.style.cssText = 'width:90px; height:90px; display:flex; align-items:center; justify-content:center; border:2px dashed #aaa; border-radius:8px; background:#fdfdfd;';

    const plus = document.createElement('span');
    plus.textContent = '+';
    plus.style.cssText = 'font-size:40px; color:#999;';
    thumbnail.appendChild(plus);
    wrapper.appendChild(thumbnail);
    container.appendChild(wrapper);

    wrapper.addEventListener('click', () => {
      const tempInput = document.createElement('input');
      tempInput.type = 'file';
      tempInput.accept = 'image/*';
      tempInput.style.display = 'none';
      document.body.appendChild(tempInput);

      tempInput.addEventListener('change', function () {
        if (tempInput.files.length > 0) {
          const file = tempInput.files[0];
          createImageBoxFromFile(file);
        }
        tempInput.remove();
      });

      tempInput.click();
    });
  }

  function showError(msg) {
    document.getElementById('review_error-images').textContent = msg;
  }

  document.getElementById('review_openReviewPopup').addEventListener('click', function () {
    container.innerHTML = '';
    imageCount = 0;
    showError('');

    if (window.existingReviewImages && Array.isArray(window.existingReviewImages)) {
      window.existingReviewImages.forEach(function (img) {
        createImageBox(img.url, img.filename);
      });
    }

    updateAddButton();
    document.getElementById('review_reviewPopupOverlay').style.display = 'block';
  });
});
</script>

{# -------------------------------------------------------------- #}

<script>


document.addEventListener('DOMContentLoaded', function () {
// MVC-L Controller: Handles validation logic
const ReviewController = {
init: function () {
document.getElementById('review_button-review').addEventListener('click', this.handleSubmit);
document.getElementById('review_input-name').addEventListener('input', this.clearNameError);
},

// Validation Logic (Model Layer)
validateName: function (name) {
if (! name.trim()) 
return 'Name is required.';

if (name.length < 3 || name.length > 25) 
return 'Name must be between 3 and 25 characters.';

return '';
},

// Controller Logic
handleSubmit: function () {
let hasError = false;

// Model: Get data
const name = document.getElementById('review_input-name').value.trim();

// Validate
const nameError = ReviewController.validateName(name);

// View: Show errors
if (nameError) {
document.getElementById('review_error-name').textContent = nameError;
hasError = true;
}

// Continue only if no errors
if (! hasError) {
// You can trigger form submission or your AJAX call here
// Example: document.getElementById('form-review').submit();
console.log("Form ready to submit");
}
},

clearNameError: function () {
const name = document.getElementById('review_input-name').value.trim();
if (name.length >= 3 && name.length<= 25) {
        document.getElementById('review_error-name').textContent = '';
      }
    }
  };

  // Init the controller
  ReviewController.init();
});

</script>


<script>

document.addEventListener('DOMContentLoaded', function () {
  const ReviewController = {
    init: function () {
      document.getElementById('review_button-review').addEventListener('click', this.handleSubmit);
      document.getElementById('review_input-review').addEventListener('input', this.clearReviewError);
    }, // === Model & Logic Layer ===
    validateReviewText: function (text) {
      if (!text.trim()) return 'Review is required.';
      if (text.length < 3 || text.length > 1000) return 'Review must be between 3 and 1000 characters.';
      return '';
    }, // === Controller Layer ===
    handleSubmit: function () {
      let hasError = false;

      // Get review text
      const reviewText = document.getElementById('review_input-review').value.trim();

      // Validate
      const reviewError = ReviewController.validateReviewText(reviewText);

      // Show error in View
      if (reviewError) {
        document.getElementById('review_error-review').textContent = reviewError;
        hasError = true;
      }

      // If no error, continue to submit (example: AJAX or form submission)
      if (!hasError) {
        console.log("Review text is valid.");
        // Proceed with submission
      }
    }, // === Clear error on typing ===
    clearReviewError: function () {
      const reviewText = document.getElementById('review_input-review').value.trim();
      if (reviewText.length >= 3 && reviewText.length<= 1000) {
        document.getElementById('review_error-review').textContent = '';
      }
    }
  };

  // Initialize controller
  ReviewController.init();
});


</script>




<script>

document.addEventListener('DOMContentLoaded', function () {
  const ReviewController = {
    init: function () {
      document.getElementById('review_button-review').addEventListener('click', this.handleSubmit);
      document.querySelectorAll('.review_rating-star').forEach(star => {
star.addEventListener('click', this.selectRating);
}) 

},

// === Model & Logic Layer ===
getRatingValue: function () {
return document.getElementById('review_rating-value').value.trim();
},

validateRating: function (value) {
if (! value || parseInt(value) < 1 || parseInt(value) > 5) {
return 'Please select a rating between 1 and 5.';
}
return '';
},

// === Controller Layer ===
handleSubmit: function () {
let hasError = false;

// --- Validate Rating ---
const ratingValue = ReviewController.getRatingValue();
const ratingError = ReviewController.validateRating(ratingValue);

if (ratingError) {
document.getElementById('review_error-rating').textContent = ratingError;
hasError = true;
} else {
document.getElementById('review_error-rating').textContent = '';
}

// If no errors in all fields, proceed with submission
if (! hasError) {
console.log("Rating is valid. Submitting...");
// You can now submit the form using AJAX or normal POST
}
},

// === Rating Star Selection Logic ===
selectRating: function (event) {
const selectedRating = event.target.getAttribute('data-value');
document.getElementById('review_rating-value').value = selectedRating;

// Highlight selected stars
document.querySelectorAll('.review_rating-star').forEach(star => {
const value = parseInt(star.getAttribute('data-value'));
star.classList.toggle('fa-solid', value <= selectedRating);
star.classList.toggle('fa-regular', value > selectedRating);
});

// Clear error message when a valid rating is selected
if (selectedRating >= 1 && selectedRating <= 5) {
document.getElementById('review_error-rating').textContent = '';
}
}
};

ReviewController.init();
});


</script>

<script>

document.getElementById('review_button-review').addEventListener('click', function () {
// Clear previous messages
document.getElementById('review_error-name').textContent = '';
document.getElementById('review_error-review').textContent = '';
document.getElementById('review_error-rating').textContent = '';
document.getElementById('review_error-images').textContent = '';
document.getElementById('review_review-success').style.display = 'none';

// Collect inputs
const name = document.getElementById('review_input-name').value.trim();
const review = document.getElementById('review_input-review').value.trim();
const rating = document.getElementById('review_rating-value').value.trim();
const imageCount = document.getElementById('review_image-upload-wrapper').querySelectorAll('img').length;

let hasError = false;

// Validate name
if (name.length < 3 || name.length > 25) {
document.getElementById('review_error-name').textContent = 'Name must be between 3 and 25 characters.';
hasError = true;
}

// Validate review length
if (review.length < 3 || review.length > 1000) {
document.getElementById('review_error-review').textContent = 'Review must be between 3 and 1000 characters.';
hasError = true;
}

// ❌ Check for any word over 20 characters
if (/\b\w{21,}\b/.test(review)) {
document.getElementById('review_error-review').textContent = 'Words in the review cannot exceed 20 characters.';
hasError = true;
}

// Validate rating
if (! rating || rating < 1 || rating > 5) {
document.getElementById('review_error-rating').textContent = 'Please select a rating between 1 and 5.';
hasError = true;
}

// Validate images - at least 2 required


if (hasError) 
return;


// Show success message
document.getElementById('review_review-success').style.display = 'block';
document.getElementById('review_review-success').textContent = 'Your review has been submitted successfully!';

// Redirect after 2 seconds
setTimeout(() => {
window.location.href = window.location.pathname + '#tab-review';
window.location.reload();
});
});


// Auto-clear image error when 2 or more images are uploaded
//  const imageWrapper = document.getElementById('review_image-upload-wrapper');
// const imageErrorEl = document.getElementById('review_error-images');

// const observer = new MutationObserver(() => {
// const imgCount = imageWrapper.querySelectorAll('img').length;
// if (imgCount > 2) {
// imageErrorEl.textContent = '';
// }
// }); 

// Start observing image container
// observer.observe(imageWrapper, {
// childList: true,
// subtree: true
// });
</script>



<script type="text/javascript">
$('#review').delegate('.pagination a', 'click', function (e) {
  e.preventDefault();
  $('#review').fadeOut('slow');
  $('#review').load(this.href);
  $('#review').fadeIn('slow');
});

// Load reviews initially
$('#review').load('index.php?route=product/product/review&product_id={{ product_id }}');

// Submit review
$('#review_button-review').on('click', function () {
  var form = $('#review_form-review')[0];
  var formData = new FormData(form);

  $.ajax({
    url: 'index.php?route=product/product/write&product_id={{ product_id }}',
    type: 'post',
    data: formData,
    processData: false,
    contentType: false,
    dataType: 'json',
    beforeSend: function () {
      $('#review_button-review').button('loading');
    },
    complete: function () {
      $('#review_button-review').button('reset');
    },
    success: function (json) {
      $('.alert-dismissible').remove();

      if (json['success']) {
        // Optional: Success message
        $('#review').after('<div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> ' + json['success'] + '</div>');

        // Clear form
        $('input[name="name"]').val('');
        $('textarea[name="text"]').val('');
        $('input[name="rating"]').prop('checked', false);
        $('#review_image-upload-wrapper').empty();
        imageCount = 0;
        createAddButton();

        // Redirect to home quickly
        setTimeout(function () {
          window.location.href = 'index.php?route=common/home';
        }, 1000);
      }
    }
  });
});
</script>
{# Added new Changes #}


<script>
document.addEventListener('DOMContentLoaded', function () {
    const existingSection = document.querySelectorAll('#review_product-review-section');
    if (existingSection.length > 1) {
        // Remove duplicates, keep only the first
        for (let i = 1; i < existingSection.length; i++) {
            existingSection[i].remove();
        }
    }
});
</script>


{#review end #}

<script type="text/javascript"><!--
	$(document).ready(function() {
	
		var zoomCollection = '.large-image img';
		$( zoomCollection ).elevateZoom({
			zoomType        :"none",
			lensSize    :'200',
			easing:true,
			
			gallery:'thumb-slider',
			cursor: 'pointer',
			galleryActiveClass: "active",
		});
		$(zoomCollection).bind('touchstart', function(){
		    $(zoomCollection).unbind('touchmove');
		});

		
		$("#thumb-slider .image-additional").each(function() {
			$(this).find("[data-index='0']").addClass('active');
		});
		
		$('.product-options li.radio').click(function(){
			$(this).addClass(function() {
				if($(this).hasClass("active")) return "";
				return "active";
			});
			
			$(this).siblings("li").removeClass("active");
			$(this).parent().find('.selected-option').html('<span class="label label-success">'+ $(this).find('img').data('original-title') +'</span>');
		})
		
		$('.thumb-video').magnificPopup({
		  type: 'iframe',
		  iframe: {
			patterns: {
			   youtube: {
				  index: 'youtube.com/', // String that detects type of video (in this case YouTube). Simply via url.indexOf(index).
				  id: 'v=', // String that splits URL in a two parts, second part should be %id%
				  src: '//www.youtube.com/embed/%id%?autoplay=1' // URL that will be set as a source for iframe. 
					},
				}
			}
		});
	
		
	});
//--></script>


<script type="text/javascript">
var ajax_price = function() {
	$.ajax({
		type: 'POST',
		url: 'index.php?route=extension/soconfig/liveprice/index',
		data: $('.product-detail input[type=\'text\'], .product-detail input[type=\'hidden\'], .product-detail input[type=\'radio\']:checked, .product-detail input[type=\'checkbox\']:checked, .product-detail select, .product-detail textarea'),
		dataType: 'json',
			success: function(json) {
			if (json.success) {
				change_price('#price-special', json.new_price.special);
				change_price('#price-tax', json.new_price.tax);
				change_price('#price-old', json.new_price.price);
			}
		}
	});
}

var change_price = function(id, new_price) {$(id).html(new_price);}
$('.product-detail input[type=\'text\'], .product-detail input[type=\'hidden\'], .product-detail input[type=\'radio\'], .product-detail input[type=\'checkbox\'], .product-detail select, .product-detail textarea, .product-detail input[name=\'quantity\']').on('change', function() {
	ajax_price();
});
</script>
{#check pincode start #}
<script>
    document.addEventListener("DOMContentLoaded", function () {
      const input = document.getElementById('pincode-input');
      const checkBtn = document.getElementById('check-pincode');
      const dropdown = document.querySelector('.pincode-dropdown');
      const recentPincodes = document.querySelector('.recent-pincodes');
      const loader = document.getElementById('pincode-loader');
      const errorDiv = document.querySelector('.pincode-error');
      const successDiv = document.querySelector('.pincode-success');

      // Attach click to pre-rendered saved address items
      document.querySelectorAll('.pincode-dropdown .address-item').forEach(item => {
        item.addEventListener('click', () => {
          input.value = item.dataset.pincode;
          hideDropdown();
          checkPincodeAvailability();
        });
      });


      // Auto-select default address if available
      const defaultAddress = document.querySelector('.pincode-dropdown .address-item.selected');
      if (defaultAddress) {
        input.value = defaultAddress.dataset.pincode;
        checkPincodeAvailability();
      }

      // Check pincode
      async function checkPincodeAvailability() {
        const value = input.value.trim();

        if (!value || !/^\d{6}$/.test(value)) {
          errorDiv.textContent = "Please enter a valid 6-digit pincode";
          errorDiv.style.display = "block";
          successDiv.style.display = "none";
          hideLocationInfo();
          return;
          
        }

        loader.style.display = 'inline-block';
        errorDiv.style.display = "none";
        successDiv.style.display = "none";

        try {
          const formData = new FormData();
          formData.append('product_id', '{{ product_id }}');
          formData.append('pincode', value);

          const response = await fetch('index.php?route=clickpost/pincode_serviceability/checkPincode', {
            method: 'POST',
            body: formData
          });

          const data = await response.json();
          loader.style.display = 'none';

          if (!data.success || data.error) {
            errorDiv.textContent = data.error || "Delivery not available to this pincode";
            errorDiv.style.display = "block";
            successDiv.style.display = "none";
            hideLocationInfo();
            return;
          }

          successDiv.innerHTML = `✓ Delivery available to ${value}`;
          if (data.estimated_delivery)
            successDiv.innerHTML += `<br>Estimated delivery: ${data.estimated_delivery}`;
          if (data.courierCharges && !data.freeCharges)
            successDiv.innerHTML += `<br>Delivery charges: ₹${data.courierCharges}`;
          if (data.freeCharges)
            successDiv.innerHTML += `<br><strong>Free Delivery</strong>`;

          successDiv.style.display = "block";
          errorDiv.style.display = "none";
          
          hideLocationInfo();

          localStorage.setItem('defaultPincode', value);
          updateRecentPincode(value);
        } catch (error) {
          loader.style.display = 'none';
          errorDiv.textContent = "Error checking pincode. Please try again.";
          errorDiv.style.display = "block";
          successDiv.style.display = "none";
          hideLocationInfo();
        }
      }

      // Save recent
      async function updateRecentPincode(pincode) {
        let pins = JSON.parse(localStorage.getItem('recentPincodes') || '[]');
        pins = [pincode, ...pins.filter(p => p !== pincode)].slice(0, 5);
        localStorage.setItem('recentPincodes', JSON.stringify(pins));

        {% if is_logged %}
        await fetch('index.php?route=account/account/addPincodeHistory', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: 'pincode=' + encodeURIComponent(pincode)
        });
        {% endif %}
      }

      // Load from localStorage + DB
      async function loadRecentSearches() {
        let pins = JSON.parse(localStorage.getItem('recentPincodes') || '[]');

        {% if is_logged %}
        try {
          const response = await fetch('index.php?route=account/account/getPincodeHistory');
          const data = await response.json();
          if (data.success && data.pincodes)
            pins = [...new Set([...data.pincodes, ...pins])];
        } catch (e) { console.warn(e); }
        {% endif %}

        recentPincodes.innerHTML = '';
        pins.slice(0, 5).forEach(p => {
          const pill = document.createElement('span');
          pill.className = 'recent-pincode';
          pill.textContent = p;
          pill.onclick = () => {
            input.value = p;
            hideDropdown();
            checkPincodeAvailability();
          };
          recentPincodes.appendChild(pill);
        });
      }

      // Dropdown controls
      function showDropdown() {
        dropdown.style.display = 'block';
        loadRecentSearches();

        // Scroll to selected (default) address
  const selected = dropdown.querySelector('.address-item.selected');
  if (selected) {
    selected.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
      }

      function hideDropdown() {
        setTimeout(() => dropdown.style.display = 'none', 200);
      }

      // Events
      input.addEventListener('focus', showDropdown);
      input.addEventListener('blur', hideDropdown);
      input.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          checkPincodeAvailability();
        }
      });
      checkBtn.addEventListener('click', checkPincodeAvailability);

      // Auto check default pincode if present
      {% if default_postcode %}
      setTimeout(() => {
        input.value = '{{ default_postcode }}';
        checkPincodeAvailability();
      }, 500);
      {% endif %}

      loadRecentSearches();
    });
</script>

{#added on  for geolocation#}

<script>
  let dropPincode = '';
  let pickupPincode = '';
  let dropDetails = {};
  //const apiKey = 'cf04ad8a01394f619514368ea8b8aac3';
  const deliveryDiv = document.getElementById('delivery-estimate-info');
  //const ip = '152.56.1.13'; // Use '' for current user's IP
  //const ip = '';
  //old code start
  async function fetchDropLocation(pincode) {
		const res = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
		const data = await res.json();
		const po = data[0]?.PostOffice?.[0];
		if (!po) throw new Error("Invalid drop pincode");
		dropDetails = {
			
		block: po.suburb || po.neighbourhood || po.Block || po.Name || po.city_district || '',
		city: po.District,
		state: po.State,
		country: po.Country || 'India'
		};
		document.getElementById('location-info').innerText =
		`${pincode} (${dropDetails.block}, ${dropDetails.city}, ${dropDetails.state}, ${dropDetails.country})`;
  	}
//old code ends

  async function fetchPickupLocation() {
    const productId = document.querySelector('input[name="product_id"]')?.value;
    if (!productId) throw new Error("Product ID not found");
    const vendorRes = await fetch('index.php?route=product/product/getVendorPostcode', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: 'product_id=' + encodeURIComponent(productId)
    });
    const vendorData = await vendorRes.json();
    pickupPincode = vendorData.postcode;

    const pickupInfo = await fetch(`https://api.postalpincode.in/pincode/${pickupPincode}`);
    const pickupData = await pickupInfo.json();
    const po = pickupData[0]?.PostOffice?.[0];

    document.getElementById('vendor-location-info').innerText =
      po ? `Seller Location: ${po.Name}, ${po.District}, ${po.State} (Pincode: ${pickupPincode})` :
      `Seller Pincode: ${pickupPincode}`;

	  // this line is used for hidding seller details
	  document.getElementById("vendor-location-info").style.display = "none";


  }

  async function getDeliveryEstimate() {
    if (!pickupPincode || !dropPincode) return;

    const response = await fetch('https://ds.clickpost.in/api/v2/predicted_sla_api/?username=ipshopy-test&key=6cb47441-af83-4d3f-bc49-cbbece04a4c0', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify([{ pickup_pincode: pickupPincode, drop_pincode: dropPincode }])
    });

    const result = await response.json();
    const info = result?.result?.[0];
    if (!info || !info.predicted_sla_min) {
      deliveryDiv.innerText = 'Could not fetch delivery estimate.';
      return;
    }

    const minDays = info.predicted_sla_min;
    const maxDays = info.predicted_sla_max;

    const today = new Date();
    const minDate = new Date(today);
    const maxDate = new Date(today);
    minDate.setDate(today.getDate() + minDays);
    maxDate.setDate(today.getDate() + maxDays);

    const format = d => d.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });

	deliveryDiv.innerText = minDays === maxDays
  ? `Expected Delivery: within ${minDays} business days\n  Delivery available to ${dropPincode}`
  : `Estimated Delivery: ${minDays} - ${maxDays} business days\n ✓ Delivery available to ${dropPincode}`;


  }



//new code start 23/06/25

document.addEventListener('DOMContentLoaded', async () => {
  try {
    if (!navigator.geolocation) {
      throw new Error("Geolocation is not supported by this browser.");
    }

    navigator.geolocation.getCurrentPosition(async (position) => {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;

      const geoRes = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
      const geoData = await geoRes.json();

      const address = geoData.address || {};
      dropPincode = address.postcode || '';
      const city = address.city || address.town || address.village || '';
      const state = address.state || '';
      const country = address.country || '';

      document.getElementById('location-info').innerText =
        `${dropPincode} (${city}, ${state}, ${country})`;

      // Set dropDetails for delivery estimation
      dropDetails = {city, state, country };

      // Fetch vendor pin (but skip drop location UI overwrite)
     // await fetchDropLocation(dropPincode, true);
      await fetchPickupLocation();
      await getDeliveryEstimate();

    }, (error) => {
      document.getElementById('location-info').innerText = 'Location access denied or unavailable.';
      console.error(error);
    });

  } catch (err) {
    document.getElementById('location-info').innerText = 'Error fetching initial data.';
    console.error(err);
  }
});


function hideLocationInfo() {
  const loc = document.getElementById('location-info');
  const vendor = document.getElementById('vendor-location-info');
  const estimate = document.getElementById('delivery-estimate-info');
  if (loc) loc.style.display = 'none';
  if (vendor) vendor.style.display = 'none';
  if (estimate) estimate.style.display = 'none';
}

</script>
{#check pincode end #}

{#warranty,replacement and return policy start #}
<script>
	let currentOpenModal = null;

	function openModal(type) {
		const overlay = document.getElementById('modalOverlay');
		const modals = {
			warranty: document.getElementById('warrantyModal'),
			return: document.getElementById('returnModal'),
			cash: document.getElementById('cashModal'),
			replacement: document.getElementById('replacementModal')
		};

		// If the same modal is open, close it
		if (currentOpenModal === type) {
			closeModal();
			return;
		}

		// Hide all modals
		for (const key in modals) {
			modals[key].style.display = 'none';
		}

		// Show the selected modal
		modals[type].style.display = 'block';
		overlay.style.display = 'flex';
		currentOpenModal = type;
	}

	function closeModal() {
		document.getElementById('modalOverlay').style.display = 'none';
		document.getElementById('warrantyModal').style.display = 'none';
		document.getElementById('returnModal').style.display = 'none';
		document.getElementById('cashModal').style.display = 'none';
		document.getElementById('replacementModal').style.display = 'none';
		currentOpenModal = null;
	}

	// Close modal if clicking outside of the modal content
	document.getElementById('modalOverlay').addEventListener('click', function (e) {
		if (e.target === this) {
			closeModal();
		}
	});
</script>
{#warranty,replacement and return policy ends #}
<!-- faq start -->
<script>
	document.addEventListener('DOMContentLoaded', function () {
		const showMoreBtn = document.getElementById('show-more-faqs');
		const showLessBtn = document.getElementById('show-less-faqs');
		const faqItems = document.querySelectorAll('.product-faqs .faq-item');

		if (showMoreBtn && showLessBtn) {
			showMoreBtn.addEventListener('click', function () {
				faqItems.forEach(item => item.style.display = 'block');
				showMoreBtn.style.display = 'none';
				showLessBtn.style.display = 'inline-block';
			});

			showLessBtn.addEventListener('click', function () {
				faqItems.forEach((item, index) => {
					item.style.display = (index < 4) ? 'block' : 'none';
				});
				showMoreBtn.style.display = 'inline-block';
				showLessBtn.style.display = 'none';
			});
		}
	});
</script>


<!-- faq end -->
<!-- faq starts-->

<script>
	// Open modal
	$('#ask-question-btn').on('click', function () {
		$('#askQuestionModal').modal('show');
	});

	// Submit form
	$('#ask-question-form').on('submit', function (e) {
		e.preventDefault();

		$.ajax({
			url: 'index.php?route=product/product/submitFaq',
			type: 'POST',
			data: $(this).serialize(),
			dataType: 'json',
			success: function (json) {
				if (json.success) {
					alert('Your question has been submitted.');
					$('#faq-question').val('');
					$('#askQuestionModal').modal('hide');
				} else {
					alert(json.error || 'Submission failed.');
				}
			},
			error: function () {
				alert('An error occurred. Please try again.');
			}
		});
	});

	// Close modal on login link click
	$(document).on('click', '.faq-login-link', function (e) {
		e.preventDefault();
		const href = $(this).attr('href');
		$('#askQuestionModal').modal('hide');
		setTimeout(() => {
			window.location.href = href;
		}, 300);
	});

</script>
{#faq end#}
{{ footer }} 
