{{ header }}
{{ column_left }}

<div id="content" style="background-color: #f5f7fa; min-height: 100vh;">
  <div class="page-header" style="border-bottom: 1px solid #ddd;">
    <div class="container-fluid">
      <h1 style="color: #333;"><i class="fa fa-user"></i> Seller Registrations</h1>
    </div>
  </div>

  <div class="container-fluid">
    <div class="panel panel-default" style="box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-radius: 8px;">
      <div class="panel-heading" style="background-color: white; color: black; border-radius: 8px 8px 0 0;">
        <h3 class="panel-title"><i class="fa fa-filter"></i> Filter by Username</h3>
      </div>

      <div class="panel-body" style="background-color: #f5f5f5; border-radius: 0 0 8px 8px;">
        <form action="{{ action }}" method="get" id="filter-form">
          <input type="hidden" name="route" value="tracking/seller_list/user" />
          <input type="hidden" name="user_token" value="{{ user_token }}" />
          <div class="row" style="margin-bottom: 15px;">
            <div class="col-sm-4">
              <label for="input-username" style="font-weight: bold; color: #333;">Username</label>
              <input type="text" name="filter_username" value="{{ filter_username }}" placeholder="Username" id="input-username" class="form-control" autocomplete="off" />
            </div>
            <div class="col-sm-3" style="margin-top: 25px;">
              <button type="button" id="button-filter" class="btn btn-primary btn-block">
                <i class="fa fa-filter"></i> Filter
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="panel panel-default" style="box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-radius: 8px;">
      <div class="panel-heading" style="background-color: white; color: black; border-radius: 8px 8px 0 0;">
        <h3 class="panel-title"><i class="fa fa-list"></i> User List</h3>
      </div>
      <div class="panel-body">
        <div class="table-responsive">
          <table class="table table-bordered table-hover">
            <thead style="background-color: #f1f1f1;">
              <tr>
                <th>Username</th>
                <th>Total Registrations</th>
                <th class="text-center">Action</th>
              </tr>
            </thead>
            <tbody>
              {% if users %}
                {% for user in users %}
                  <tr>
                    <td>{{ user.registered_by }}</td>
                    <td>{{ user.total }}</td>
                    <td class="text-center">
                      <a href="{{ user.view }}" class="btn btn-primary btn-sm">
                        <i class="fa fa-eye"></i>
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="3" class="text-center">No results found</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Autocomplete Dependencies -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.min.css" />
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

<script type="text/javascript">
$(document).ready(function () {
  $('#input-username').autocomplete({
    minLength: 0,
    delay: 100,
    source: function (request, response) {
      $.ajax({
        url: 'index.php?route=tracking/seller_list/autocomplete&user_token={{ user_token }}&filter_username=' + encodeURIComponent(request.term),
        dataType: 'json',
        success: function (json) {
          response($.map(json, function (item) {
            return {
              label: item.username,
              value: item.username
            };
          }));
        },
        error: function () {
          console.error("Autocomplete AJAX failed");
          response([]);
        }
      });
    },
    focus: function (event, ui) {
      $('#input-username').val(ui.item.label);
      return false;
    },
    select: function (event, ui) {
      $('#input-username').val(ui.item.label);
      return false;
    }
  });

  $('#input-username').focus(function () {
    $(this).autocomplete("search", "");
  });

  $('#button-filter').on('click', function () {
    let url = 'index.php?route=tracking/seller_list/user&user_token={{ user_token }}';
    let filter_username = $('#input-username').val();
    if (filter_username !== '') {
      url += '&filter_username=' + encodeURIComponent(filter_username);
    }
    location = url;
  });
});
</script>

{{ footer }}
