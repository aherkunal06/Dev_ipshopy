{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="pull-right"><a href="{{ add }}" data-toggle="tooltip" title="{{ button_add }}" class="btn btn-primary"><i class="fa fa-plus"></i></a>
        <button type="button" data-toggle="tooltip" title="{{ button_delete }}" class="btn btn-danger" onclick="confirm('{{ text_confirm }}') ? $('#form-manufacturer').submit() : false;"><i class="fa fa-trash-o"></i></button>
      </div>
      <h1>{{ heading_title }}</h1>
      <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
        <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="container-fluid">
    {% if error_warning %}
    <div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    {% if success %}
    <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
      <button type="button" class="close" data-dismiss="alert">&times;</button>
    </div>
    {% endif %}
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title"><i class="fa fa-list"></i> {{ text_list }}</h3>
      </div>
      <div class="panel-body">
      {#----- added changes for the manufacturer filter on 25-04-2025----------------------- #}
      <!-- added by shubham 25-04-2025 -------------------------------------->
      <div class="well">
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <label class="control-label" for="input-filter_vendor">{{ entry_vendor }}</label>
              <input type="text" name="filter_vendor" value="{{ filter_vendor }}" placeholder="{{ entry_vendor }}" id="input-filter_vendor" class="form-control" />
              <input type="hidden" name="vendor_id" value="{{ filter_vendor1 }}" />
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="control-label" for="input-name">{{ entry_manufacturer_name }}</label>
              <input type="text" name="filter_name" value="{{ filter_name }}" placeholder="{{ entry_manufacturer_name }}" id="input-name" class="form-control" />
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label class="control-label" for="input-status">{{ entry_status }}</label>
              <select name="filter_status" id="input-status" class="form-control">
                <option value=""></option>
                {% if filter_status == '1' %}
                  <option value="1" selected="selected">{{ text_enabled }}</option>
                {% else %}
                  <option value="1">{{ text_enabled }}</option>
                {% endif %}
                {% if filter_status == '0' %}
                  <option value="0" selected="selected">{{ text_disabled }}</option>
                {% else %}
                  <option value="0">{{ text_disabled }}</option>
                {% endif %}
                {% if filter_status == '2' %}
                  <option value="2" selected="selected">{{ text_approvepending }}</option>
                {% else %}
                  <option value="2">{{ text_approvepending }}</option>
                {% endif %}
              </select>
            </div>
            <button type="button" id="button-filter" class="btn btn-primary pull-right col-sm-12">
              <i class="fa fa-search"></i> {{ button_filter }}
            </button>
          </div>
        </div>
      </div>
      <!------------------------------------------------=================----------===========  -->
      {#------------------------------------------------------------------------------------------#}
        <form action="{{ delete }}" method="post" enctype="multipart/form-data" id="form-manufacturer">
          {#<div class="table-responsive">#}
          {#  <table class="table table-bordered table-hover">#}
          {#    <thead>#}
          {#      <tr>#}
          {#        <td style="width: 1px;" class="text-center"><input type="checkbox" onclick="$('input[name*=\'selected\']').prop('checked', this.checked);" /></td>#}
          {#        <td class="text-left">{% if sort == 'name' %}#}
          {#          <a href="{{ sort_name }}" class="{{ order|lower }}">{{ column_name }}</a>#}
          {#          {% else %}#}
          {#          <a href="{{ sort_name }}">{{ column_name }}</a>#}
          {#          {% endif %}</td>#}
          {#        <td class="text-right">{% if sort == 'sort_order' %}#}
          {#          <a href="{{ sort_sort_order }}" class="{{ order|lower }}">{{ column_sort_order }}</a>#}
          {#          {% else %}#}
          {#          <a href="{{ sort_sort_order }}">{{ column_sort_order }}</a>#}
          {#          {% endif %}</td>#}
          {#        <td class="text-right">{{ column_action }}</td>#}
          {#      </tr>#}
          {#    </thead>#}
          {#    <tbody>#}
          {#      {% if manufacturers %}#}
          {#      {% for manufacturer in manufacturers %}#}
          {#      <tr>#}
          {#        <td class="text-center">{% if manufacturer.manufacturer_id in selected %}#}
          {#          <input type="checkbox" name="selected[]" value="{{ manufacturer.manufacturer_id }}" checked="checked" />#}
          {#          {% else %}#}
          {#          <input type="checkbox" name="selected[]" value="{{ manufacturer.manufacturer_id }}" />#}
          {#          {% endif %}</td>#}
          {#        <td class="text-left">{{ manufacturer.name }}</td>#}
          {#        <td class="text-right">{{ manufacturer.sort_order }}</td>#}
          {#        <td class="text-right"><a href="{{ manufacturer.edit }}" data-toggle="tooltip" title="{{ button_edit }}" class="btn btn-primary"><i class="fa fa-pencil"></i></a></td>#}
          {#      </tr>#}
          {#      {% endfor %}#}
          {#      {% else %}#}
          {#      <tr>#}
          {#        <td class="text-center" colspan="4">{{ text_no_results }}</td>#}
          {#      </tr>#}
          {#      {% endif %}#}
          {#    </tbody>#}
          {#  </table>#}
          {#</div>#}
          {#---- added changes regarding to the 25-04-2025------------------------------#}
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead>
                <tr>
                  <td style="width: 1px;" class="text-center">
                    <input type="checkbox" onclick="$('input[name*=\'selected\']').prop('checked', this.checked);" />
                  </td>
                  <td class="text-center">{{ column_image }}</td>
                  <td class="text-left">{{ column_seller_name }}</td>
                  <td class="text-left">{{ column_store_name }}</td>
                  <td class="text-left">
                    {% if sort == 'name' %}
                    <a href="{{ sort_name }}" class="{{ order|lower }}">{{ column_name }}</a>
                    {% else %}
                    <a href="{{ sort_name }}">{{ column_name }}</a>
                    {% endif %}
                  </td>
                  <td class="text-left">{{ column_status }}</td>
                  <td class="text-right">{{ column_action }}</td>
                  <td class="text-center">{{ column_view_declaration }}</td>
                  <td class="text-left">{{ column_approval_comment }}</td>
                </tr>
              </thead>
              <tbody>
                {% if manufacturers %}
                {% for manufacturer in manufacturers %}
                <tr>
                  {#<td class="text-center">#}
                  {#  <input type="checkbox" name="selected[]" value="{{ manufacturer.manufacturer_id }}" {% if#}
                  {#    manufacturer.manufacturer_id in selected %}checked="checked" {% endif %} />#}
                  {#</td>#}
                  <td class="text-center">
                    <input type="checkbox"
                           name="selected[]"
                           value='{{ manufacturer.manufacturer_id }}::{{ manufacturer.vendor_id }}'
                           {% if manufacturer.manufacturer_id in selected %}checked="checked"{% endif %} />
                  </td>
                  <td class="text-center">
                    {% if manufacturer.image %}
                    <img src="{{ manufacturer.image }}" alt="{{ manufacturer.name }}" class="img-thumbnail"
                      style="height:40px;" />
                    {% else %}
                    <span class="text-muted">No Image</span>
                    {% endif %}
                  </td>
                  <td class="text-left">
                    <a href="{{ manufacturer.sellerpage }}" target="_blank">{{ manufacturer.sellername }}</a>
                  </td>
                  <td class="text-left">{{ manufacturer.vendorstorename }}</td>
                  <td class="text-left">{{ manufacturer.name }}</td>
                  <td class="text-left">
                    <span class="label
                          {% if manufacturer.cstatus == 'Disabled' %}
                            label-danger
                          {% elseif manufacturer.cstatus == 'Approval Pending' %}
                            label-warning
                          {% else %}
                            label-success
                          {% endif %}">
                      {{ manufacturer.cstatus }}
                    </span>
                  </td>
                  <td class="text-left">
                    {#{% if manufacturer.statuss %}#}
                    {#<a href="{{ manufacturer.statuss }}" data-toggle="tooltip" title="{{ button_status }}"#}
                    {#  class="btn btn-success">#}
                    {#  <i class="fa fa-thumbs-o-up"></i>#}
                    {#</a>#}
                    {#{% else %}#}
                    {#<button type="button" class="btn btn-danger">#}
                    {#  <i class="fa fa-thumbs-o-down"></i>#}
                    {#</button>#}
                    {#{% endif %}#}
                    {% if manufacturer.statuss %}
                          <a href="{{ manufacturer.statuss }}"
                             data-toggle="tooltip"
                             title="{{ button_status }}"
                             class="btn btn-success">
                            <i class="fa fa-thumbs-o-up"></i>
                          </a>
                        {% else %}
                        <a href="{{ manufacturer.url_disstatus }}"
                           data-toggle="tooltip"
                           title="{{ button_status }}"
                           class="btn btn-danger">
                          <i class="fa fa-thumbs-o-down"></i>
                        </a>
                        
                        {% endif %}

                    <a href="{{ manufacturer.edit }}" data-toggle="tooltip" title="{{ button_edit }}"
                      class="btn btn-primary">
                      <i class="fa fa-pencil"></i>
                    </a>
                  </td>

                
                  <td class="text-center">
                    {% if manufacturer.view_declaration_url %}
                    <a href="{{ manufacturer.view_declaration_url }}" class="btn btn-xs btn-info" target="_blank">
                      <i class="fa fa-eye"></i> View
                    </a>
                    {% else %}
                    <span class="text-muted">No Declaration</span>
                    {% endif %}


                  </td>

                  <!-- ====added by shubham 22-04-2025 -->




                  <td class="text-left">
                        <a href="#" 
                           class="btn btn-xs btn-info view-comment-btn" 
                           data-remote="{{ manufacturer.view_comment_url }}" 
                           data-toggle="modal" 
                           data-target="#commentModal"
                           data-manufacturer-id="{{ manufacturer.manufacturer_id }}">
                          <i class="fa fa-eye"></i> View Details
                        </a>
                      </td>
                 

                </tr>
                {% endfor %}
                {% else %}
                <tr>
                  <td class="text-center" colspan="9">{{ text_no_results }}</td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
          {#------------------------------------------------------------------------------#}
        </form>
        <div class="row">
          <div class="col-sm-6 text-left">{{ pagination }}</div>
          <div class="col-sm-6 text-right">{{ results }}</div>
        </div>
      </div>
    </div>
  </div>
</div>
{#added changes 25-04-2025-------------------#}
<!-- added by shubham 23-04-2025  filler by name and status  -->
<script type="text/javascript">
  <!--
  $('#button-filter').on('click', function() {
    var url = 'index.php?route=catalog/manufacturer&user_token={{ user_token }}';
    
    var filter_vendor = $('input[name="filter_vendor"]').val();
    if (filter_vendor) {
      url += '&filter_vendor=' + encodeURIComponent(filter_vendor);
    }
  
    var filter_vendor1 = $('input[name=\'vendor_id\']').val();
    if (filter_vendor1) {
      url += '&filter_vendor1=' + encodeURIComponent(filter_vendor1);
    }
  
    var filter_name = $('input[name="filter_name"]').val();
    if (filter_name) {
      url += '&filter_name=' + encodeURIComponent(filter_name);
    }
  
    var filter_status = $('select[name="filter_status"]').val();
    if (filter_status !== '') {
      url += '&filter_status=' + encodeURIComponent(filter_status);
    }
  
    location = url;
  });
  //-->
  </script>
  
  <script type="text/javascript">
  
  // Autocomplete for Seller (Vendor)
  $('input[name="filter_vendor"]').autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=vendor/vendor/autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
        dataType: 'json',
        success: function(json) {
          json.unshift({
            vendor_id: 0,
            vendorname: '{{ text_none }}'
          });
  
          response($.map(json, function(item) {
            return {
              label: item['vendorname'],
              value: item['vendor_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('input[name="filter_vendor"]').val(item['label']);
      $('input[name="vendor_id"]').val(item['value']);
    }
  });
  </script>
  
  <script type="text/javascript">
  <!--
  // Autocomplete for Manufacturer Name
  $('input[name="filter_name"]').autocomplete({
    'source': function(request, response) {
      $.ajax({
        url: 'index.php?route=catalog/manufacturer/autocomplete&user_token={{ user_token }}&filter_name=' + encodeURIComponent(request),
        dataType: 'json',
        success: function(json) {
          response($.map(json, function(item) {
            return {
              label: item['name'],
              value: item['manufacturer_id']
            }
          }));
        }
      });
    },
    'select': function(item) {
      $('input[name="filter_name"]').val(item['label']);
    }
  });
  //-->
  </script>
  


<!-- =============================================================== -->

<!-- added by shubham 22-04-2025 -->


<!-- Modal -->
<div class="modal fade" id="commentModal" tabindex="-1" role="dialog" aria-labelledby="commentModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <!-- Content loaded via AJAX -->
    </div>
  </div>
</div>

<script>
  $(document).on('click', '.view-comment-btn', function () {
    const comments = JSON.parse($(this).attr('data-comments'));
    let html = '';

    if (comments.length === 0) {
      html = '<p class="text-muted">No comments available.</p>';
    } else {
      comments.forEach(comment => {
        html += `
			<div class="mb-3">
			  <strong>${comment.comment_by.charAt(0).toUpperCase() + comment.comment_by.slice(1)}:</strong>
			  <p>${comment.comment}</p>
			  <small class="text-muted">${comment.date_added}</small><br>
		  `;

        if (comment.media && comment.media.length > 0) {
          comment.media.forEach(file => {
            const ext = file.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {
              html += `<img src="image/${file}" class="img-thumbnail mr-2 mb-2" width="80">`;
            } else {
              html += `<a href="image/${file}" target="_blank" class="btn btn-link btn-sm">View File</a>`;
            }
          });
        }

        html += '</div><hr>';
      });
    }

    $('#comment-modal-body').html(html);
    $('#commentModal').modal('show');
  });
</script>

<style>
  .truncate-comment {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
    display: inline-block;
    vertical-align: top;
  }

  .modal-content {
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
  }

  .modal-header {
    border-bottom: 1px solid #e0e0e0;
  }

  .img-thumbnail {
    max-height: 100px;
  }
</style>

<script>
  $(document).on('click', '.btn-view-comment', function () {
    var manufacturerId = $(this).data('manufacturer-id');

    $.ajax({
      url: 'index.php?route=catalog/manufacturer/getManufacturerCommentThread&user_token={{ user_token }}&manufacturer_id=' + manufacturerId,
      method: 'GET',
      dataType: 'json',
      success: function (json) {
        let html = '';
        if (json.length) {
          json.forEach(function (item) {
            html += `<p><strong>${item.comment_by.toUpperCase()}</strong>: ${item.comment} <br><small>${item.date_added}</small></p><hr>`;
          });
        } else {
          html = '<p>No comments yet.</p>';
        }
        $('#comment-thread-body').html(html);
        $('#commentModal').modal('show');
      }
    });
  });

  $(document).on('click', '.btn-edit-comment', function () {
    const manufacturerId = $(this).data('manufacturer-id');
    const existing = $(this).closest('td').find('.truncate-comment').text();
    const newComment = prompt("Edit comment for Manufacturer ID " + manufacturerId + ":", existing);
    if (newComment !== null) {
      $.post('index.php?route=catalog/manufacturer/saveManufacturerComment&user_token={{ user_token }}', {
        manufacturer_id: manufacturerId,
        comment: newComment
      }, function (response) {
        alert(response.success || 'Comment saved!');
        location.reload();
      }, 'json');
    }
  });
</script>
{#added =============================#}
{{ footer }}